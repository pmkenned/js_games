<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name ="viewport" content="width=device-width, initial-scale=1.0">
        <title>Chip's Challenge</title>
<style>
body {
    margin: 0;
    overflow: hidden;
}
</style>
    </head>

    <body>
        <canvas id="myCanvas"></canvas>

        <script>

// Passwords:
// Level 1:
// Level 2:
// Level 3:
// Level 4:
// Level 5: TQKB
// Level 6: WNLD
// Level 7: FXQO
// Level 8: NHAG
// Level 9: KCRE

// Reference implementation: https://archive.org/details/chips_challenge_windows_3.x

const ball_tex = new Image();
ball_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAEeSURBVEhL7ZVBDoQgDEVhzgULr6YHcwH3Yv6kCRKG8js67jQsjKn//bYUfCnF3fZs2+YByDnfhNj3/XWTdJV9ALTCT4loiaxzEGNstVJKVBoBpjmANJ7iMPHHko8WBmlyle60AEsuWRgzgKhDOqeM1TGCCxaGCmjVQwxYw4JQBp8DTRo8JEHbMAZU+654KjFPgmXgr94WDDD1n93ReWz5YewlwPke0Lp/9m5jfxI/zgAngXez9kId9oURXVzXVWPMSqR5bNVprioAScAatFqMvFfv1D4CyGmKgcA212y2xVmW5TuMn6aSB1b3s3yclL7Gn7wPOumhfbkPrIDqqBsoTVrizwDotmkDeA9+kvv/UWHBXzqLLABv2WoWIS3mDYcklamdSmA3AAAAAElFTkSuQmCC";

const block_tex = new Image();
block_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAACLSURBVEhLYzx8mIF2wNaWgYmmpjc1NdHKAqDbgabX1dWhWLB/fxPQQ5STcNOBdjAA4wCCgBwqkkCHgkwHArgFtDB91Ad4QnU0DvCnaXj4jKai0VREduk0moqIqTlGy6LRsoiYdEJkKNGxVQFpwlCFhLSIUNpFKKUHTA5ZHflsiKvJ109IL21NB7obAHCF0ipAk16EAAAAAElFTkSuQmCC";

const blue_creature_tex = new Image();
blue_creature_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAFlSURBVEhLtVZbjoQwDFtWe6zZDy7GBxyMj+FerIVXmZA+cEZDhVCpUjtx0pRh3/ev28ayLAMItm27iWJd1+8U9O8xUlsSBIB+HiPFkSCg44j6rghSuGacjiBL06uiUmskABJN0xRosF4lPlURK6SoE5wSezwIEON6FeGHm1ghBhA+FVlaCP8Eb5RHyVotsGaSU+VYNebiKwJ8+OyVmewIRWPbMs9zp0x9Vn0fHM4EvmH4LbGcqhIRyyNiHpougAJlPULloBn6jlI5dAD643hfcygE3jWqAXR1VAmoxmcuIjEHpb/qHSVKBDiPGNB7mVAIoBWLkjSGjsVrGcUckCM8ho5JMwg9B+EAXvvOvCkSKRXZDOJTBM2yLgmQQxxRvqGsJbYz8WYx3JLAZ1IRhzbNXad2bW0WDQdzvWPT2Hdpc+116fsrnqYpgmBvZKe/itQtJsrX+215g28cR08MhKEqnOidYvYHN2m6yR00ccMAAAAASUVORK5CYII=";

const blue_creature_down_tex = new Image();
blue_creature_down_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAF4SURBVEhLtVZbDoMwDFunXYsPLsYHHIwPuBczGNKs6YttrdBEq8RuYq/Fbdv2aDamaXIgWNe1EcU8z89G0ALrK+i6TlaXZcG7Xsnvw8ZzBRW8mAksLplpjUIuhwANCD2OY2ybICg+YR6hAIsXq4GGqxcokoX+ID8vck1/AIKwvUvHb2jIFAET/jCa2zRFIFV7Qx8d0I+uj82MtLSyAuBaL+k2igZhVzMEWrqo2jB3Waq/uCjnhcoWFe30qwaWIPD7NxpoUMARkS66cbzXtAjl86B1PF6uKRbLf3VLwM0GDwzjD/ODDFMsShjf/Xks5VsCZOpHIoNkPU2l7LnnfUAYObGHYcA7fovukUSm2PgaDSpZ4mHNCc4WwR76Bk7cbrlSgpYKgtcAHLyDOPq+v9wSxQ1MtcdYBH/pf4KeiPJlwLnWPFXitS2/p+YalAmwKQ7dKT2NBkhwmUDjapEqzXuDAJJABgz9iVakuUFAn9xCR4r7wvLFXeuAN1IYtjMWO/0zAAAAAElFTkSuQmCC";

const blue_creature_left_tex = new Image();
blue_creature_left_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGjSURBVEhLtVZBcoQwDCudPqsc+BgHeBgH+BcVEVVMQhKz7WZygF3HsmXZodv3/eNta57nDgDbtr0JYlmWGkDf968Br+vKgzUAeIcdLF7AGMeRGDj+5TmPAx4z2kzTRNfDMODh030SWmjukxnr0w/gjuRq6C9yRc1d8AkDqPHQBVkCRSCqlgEKxVUOHq6xSd255J3v9xncCTTPgK7tYirHkooqGSQlzdPIIZErd1xPi0xOtIvkgX320CMA0a3kIiclKD9AzvhBdcimtiIACqvF+mdstOPNoU4VcfLUY8G/QV22thS+ftFU7ilWrMss8o02ePluhiKD2Ae+4Yws5Z3xNjKINVDf/nIlUUvalkPvHZWqSPoNkdoNonn/wHXkOmvmlDy/THGSGHa37/NHAMSwu13sFAAzljfRXR803Sm5aFm7D6TacGUicDVa6RkqiB1AkH+5cBTv5cLhr8UasLfRkOrJ6xC1A/UyXGGPjEW1v8iITp1Reo7Ui14/QCLQ0msqBNd3kWGpKaTUwF/kB67tV0Xj49c3X2+w2UzHt+lf0vck9QPODP6vdO1E2wAAAABJRU5ErkJggg==";

const blue_creature_right_tex = new Image();
blue_creature_right_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGRSURBVEhLtVZBEoMwCKydPqse/JgHfZgH/ZfdFIMJkAatZjIdq4QN7ELSrOv6uG2M49gAYFmWmyCmacoA2rY9hzTPs7kwA4B32OHVCYy+700MeHsJdzD1AwzDwMbw1XWdXvu03IH26rRz4gSAWRPnj2dXqCbJHuFCeLsiKFc6RVJFMPoKCQCIgEbpGSlqUw5MAqSKkpirQWQR0EItJAAIkplbT34RRDrtJaaKtClzTg/2wH51GXkA4FGotojhlylbkncxAsOeJAaNc7OL+hELTYB6BES4VpHerAZoSq2Ntwa/1J1OAqTyLyXqHwCjAjTMoRRRX3t/f/loAsmi322FnZa0J0VBCNqXegOzrHNwTJ46APPYbzqrjWTPmQcA1qLQnDUQzARAegxUvYiwNntwwCMrNPquyo1qSuckaMnUa5Hk6J3dlVzTTowDhz4IgP3Qp1tFvLmYHUImjSNAWeHZf+hjd9A4fn/MKkObgakiwV7prwtD3os8fcblOBpdc3U8cKs4d3UU4uEQQy+6PCcigR8pbB7wevDVSAAAAABJRU5ErkJggg==";

const bomb_tex = new Image();
bomb_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAF/SURBVEhL3ZbRjoQgDEVhvwse/LCdB/0wH+C/mIuNTAEpqGs2GWImEyX3tLctqkMI6rG1LIsGwHv/EGJd15+HpJPsfwPstu5kKWUAaecUrjuMJoDUET2uO4xjQFJ320qMC45lAGMM7Obq5D4x0jrlWAZoDURSxEy6kxUvMrDGmt0TZ8wnbEiniQdj3Ku8Blp556ELRlTXUrTgjWByQAjGWu8d8sDvJ+YdREcK8qJsyDG5JFUN6OwLmkhUc9xCMrggndQJiq6QGXkNYuCewvdo/l2dGmmeZ14Jbp/AyDNw0YOtDLFf+UJCv6/XYU3Krfmm40GjfiVzdrc77dlKYvA0FftJRA8CJA3+tsIbptj6B4ArNej4zR53X7ZSBmhN2XuoI/w0fejjOrK+Ra0YubqQcQcQD74tRo6h/yn22NBKHYaPR/0MiBEHkJE4kqtP03Sli4hRv/vpZit2Ip378CoOzkK6Dh9jcQ5AQdXTVEunnVcA41PyFZ+OWu6BcTdaO996pr6Rus/NSgAAAABJRU5ErkJggg==";

const boot_flipper_tex = new Image();
boot_flipper_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGfSURBVEhL7ZZBcoMwDEXrTo5FF1yMhTmYF+Ze9MsSinBsY2DYhelkUoLfl/UlGbeu689j1zzPDgLLsjwkEUL4fQit2K8Ap+Jvuz4TftdkkAkaY4RMktr+o9u3TOagvfeg+xAAhgYpxcg/8W4umkzrwfV+GkfQ+ZM16JP2I9dFAaxWrmpoljR8PPa60AdYj/Z0zmHtlPIjO5gm9oN9Z/Jpk4WucSUZuUxmIIBE3TJZoBhl/GfpJi3nPMjDV1B9mp0QqNKbNvYKtOiV8GFAbx+cix31ww3YWUUHdBt+Kk1FHwtwv1DJ17K8p2doXlT2gIcJnaaV4qOlHfRCo2nU9BsQw4Aju7CDPvpbQKcHJUQXD4NEyl+KVW/8zBI5jiMKiUYFTZX0bkHBpqj1UblT9KBkKaD22Vwg42R6O7F94BlXOTKLaHzbmZW20kkHukbfVZHVYLTNVTH2Q3RepqLBYx42bE686aZF21HbVBfOA6qo7X3S0rmP+tF4uHwe6FbQSlKyydLOnGSV0jrRtDmYXpsXjftSpo++/LrihLoQbG3JP6auL5d9kva3AAAAAElFTkSuQmCC";

const boot_green_tex = new Image();
boot_green_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAHHSURBVEhLtZZLloMgEEW11xUHboyBLswB7st+xcMKX0U5IWlOkpZ360fBeBzH8LOxrusIwL7vP0Js2/bXKT2do6bzHkDlwQ7W4m/wXzPOGwC1lmWB7rIt0zAJwZFyzGMArYa6mQ3UOZMhM7yJx2MAlquuMqguL+B7AFiPqjPGQCvyALpQPlw+egBYOw5S2dASBknGiC7Udzt9OjwQ90X5EAY/OZLk9jNRHXOXB6pOBmbVVUYXQHWVFNre5UESnwsPuBvUjwdl2hKfPM9NAFZnS3zyKN0DaurFDD/zgI2laPuFelKpZQ98z3KVnkfmWt33wTPLKUCtDvdUwshr30dm9L1onudyFflarFhd3VnUHaXFotHybKiWaV6L4S+p7U6XotrARTpkIMrYGuyC7C357HsZO5qb/cAHvB2ADJ2FYi1++R76rXuV7isjvi/wqECLFZgb0a2CjIsc0i7MPspp65QeLifSqZ4CdGXSgSM5nJiOgSuJnAfxCKWrHjjHonXhCSz/CCKQAPKvlVbB7J0JDE/HW8XkgfRmxzT4cZfAFljh6tiewJcALssvIHkCawBtFSiEm8svnrg1M+w8ycMCaLfrllR84B+hmB3MEwGCPAAAAABJRU5ErkJggg==";

const boot_red_tex = new Image();
boot_red_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGASURBVEhLzVVbjoMwDITVHqv9yMX4gIPlo9yLnTBbY5wHSSqkpiIqoMzYM7YZt20bblvLsowgWNf1Jgrv/c9N0AL73QTP9yrI0OkBkAH6eoVtGHiH23CvV48HDHqeZ6B5PwOdyLj4ynC0eYDzwAK6cxPQuZMDe5wByNoIcEBwhUNUisNvI8B5NOU0TZBBZ0Bh0K6RBUGtBpMDAU7gGvE7FnAfz2HddzzXQjWYrNHBARZkw6gFHRzxavFgj50ZcGfUev+M4IwODoPen4HRp5ABFDO1VC1RhT7UqrnRWJ1G/aQ+VKyNIIeedLgtAw6WZOwF9KoM/qH3So+VKaOjpTGptEonkyVq6Vhd9bnalx4WdDSwcPzKv1wtljsrzIy9ckzgCYLwKKNJMnZO/hyuJbjw8zwVGPUlNDkOiWr8rInaOadNPsY1PYjnl3hYFsTgkgNun74H8inXU6wQdRJUh28J+M5MK631JaKZE2kCO00+uG/4onWzVI/rXoaxspx78Yc/OiVVaVWFpc0AAAAASUVORK5CYII=";

const boot_skate_tex = new Image();
boot_skate_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAHcSURBVEhLtVZJcoQwEItTedZw4GM+wMM4wL+I2nLau8dmKq4ZF8UiqdULmPu+v/5t7ftuQHBd1zOKZVn44HmeVYTjOB4SENrB4u+JShoQfM9qBxjWtm1AP44N6AwAf17KAOcI8DywgL6uFujcyYG9atQcAdQprnKoS6V83P8zbhGeR0UYY5z7IQJrnS2oRhRLYdFEkkWgK2phcDR+wbXXS9CxGxMbNZHkGF0aB0zgwi9Gr5X7RA6oPd69amrnXqwJggxd4lBc5XhGkPmjTJUIXDfELKMRDPlTc+k9ga/O1P26P3QsXW8IWuhSpHFu23luEnCwSGcV2nvoIxH4meUqfRpdhlU6uoGCU1x0jx3U2qWz2F/Znr4YCIixKFABvY0b+raGC3DBcgsHPK4QzGn/k6yhKzRpSOCnaT+fJutYP1DFUrYVJVtr9XhdVwbkp+lor/o3ZQ9a2wAcmKY+AnnhYdK7mU69z1QDMWu05H2gL+9kig2opthylAaL4mvZtGIOO163oJMcZARIGjL2IXSdgJ8kRH+sGtCsopBk9z2StDiZyuLDMx1PtDrVEkkyyoeq9WwLukxjiRjfEz4dVS8vZy1TSu7jKkfybRoXDyMoi28QNyHQIVWt4s9P/gK7S19VXuZdJQAAAABJRU5ErkJggg==";

const border_empty_tex = new Image();
border_empty_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAACWSURBVEhL7VbbCoAgDJ1+l7+WD/sxH9x/rUVBCtEIL1FsT0PkiOcy5oDhLCr60OfcFzCD2gyQgXsXIm7cMDhBl+LARCVBrb9JKcUlCspwiiY8IG4pDdPKTe09+gVFHTm5gvIg5uzpz3oWBNNAF9BvIbAc3BE1YRZZDhSnTtDAcvC+BpYDRYNjs8OE+mh/eGPf7Nznt+sVr/14eBSbO9QAAAAASUVORK5CYII=";

const border_full_tex = new Image();
border_full_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAC7SURBVEhL7VZLEoAgCMXOlVdz4cVc6L1KxJQ+U4tgUaOLxmnqPR5PBAMR+prZPsm8nxiMytbAgrgxcSECTNZayo2Kgozuvacw5QkI3TmnQtDQmwJDmYrsMIUQ3piQY68KirvCKWroWh5Q7IoenBVc1IGYBxp18E8PRh3sqn7UweMlOOrgMUX5g9EP7rN0PkWAc9ECcVv5f+p275/Y5vGiYwQiuD2yA4EwehlVugJxdNRRCOpcVK374nS9AlFkELOgw1cqAAAAAElFTkSuQmCC";

const button_big_brown_tex = new Image();
button_big_brown_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAEeSURBVEhL7VZJDoMwDCxVnwWHfCyH8LAc4F90qlFThGM7IEW9wAEh48x4iScZtm17dHvmeR5AsK5rJ4qc87MTdIG9CdwKtzYZ7TpghRBcdKzyCQgt4TT7ntUh2ENM03SId1kWWOBjpIK/Ly3NspLQQMs5hRDL+2v/0BiPs02BklKS6GCinTTjOGocdQKGT/R91PKbHNACjcPJwEbn39MlKuFXK3PoBGtlJGFlILE0y8Umt9THrdKdAbtyrgeYAGwkKEGMv7k1+oFRgzPmoHoy/mMOqJ1MAtHZewlZGuEDypdrqo3UDMorNVWrj38elJWaXFOCtHuJT1CUUkLY0NxXTQR0lWLZcps6QeAev1WH++LVUrfuV8cBE9QSyGWfN/ESm4DBCeVKAAAAAElFTkSuQmCC";

const button_big_cyan_tex = new Image();
button_big_cyan_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAEASURBVEhL7VZBEoMgDGz6Lj34NXkYB/2XXYnDMEISaMtwkSMTdrMJG6DjOF7dlnOOQLDveycK7/27E3SEfQjMCtc2Ge26YS3LYqLjlE3A0DmctJ+yGgQpxDzPt3y3bcMOYhQpGkE8eUHnfiQCAdNIy/bBiQ7ootvDPtNP0yRxlH3A6V/oeisDB2aBxDHCaA3pszhVxAgFpn2aAh4FZrkKJYIDcJFOiwav2osIwfBB8WUc1IMGEWr6UC8q4Bl5FapYK2wGdL2GxnsQKyuNax5B0r+k6sGRIHRollVFwKH5sKz5TTUQ2Je1FGE/ON/hpqcG+eD3xCNCdwW0rusf882hPmUgsW8AyaGtAAAAAElFTkSuQmCC";

const button_big_gray_tex = new Image();
button_big_gray_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAD8SURBVEhL7VY5DsQgDNys9lmkyMdShIdRwL+yI42EIsBHCpQmlGY8YxtsWM7z/ExbMcYFAqWUSRIppe8k6kr7CpgV9h4yjqvh2rbNZIeXLUDqnk6yX1UNgSvFuq5NvDlnWIBRUsHuT0qzepL6OI4GSTtllCUK0AcsPTW3aAcAGiEEqVvHfcDwFfYaMmQAAzs0hnk80Wj+8GutlCSeyMBsn1uANwOzXIMSoQNwkdA++76b/gAApvTaQ2fgT0IPH/nZ41oadiwgh500i+z3oHpK45ojSJp0tgCjG1Lo1LwdLgFC+2Hp+U3dEPDc1x7zfrw8dZveyYv0pnui82D+tai4/I+PUyIAAAAASUVORK5CYII=";

const button_blue_tex = new Image();
button_blue_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAADJSURBVEhL7ZRBEgMRFEQj52LhahzMgntJVyQzMlL6T1JqNl9ZKfp9/TVTa70tGzFGA0ApZREipXRfJL3JKoA6rBZdb9GJoFlr+3ol8UTQpACoHxTHldEuKaBpOed6iZwzbYDoq+jU8S3us/EgMceQHHyqH6QqGN77OUODRvt8tUV4nejz80WaoViDdXQYfZ7cg9+g5evNAOY1Jeo4KE3yWCmtvaVEChgzNXemmXYOQB/M17+I9+AH3f6IAqiBahG1yIQQ6KZ/NjwAdU18d6+qWuIAAAAASUVORK5CYII=";

const button_brown_tex = new Image();
button_brown_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAADhSURBVEhL7ZVBCsMgEEVrz6ULL+ZCD+ZC72U/DIhRcMa0UgJmIUH0P/0zP1GllNe2J4SgAMg5b0LEGN+bpKvsAbAOH4v+b9FC0LTW7Xkl8UTQpACod4rjzGiXFEBaxphWIqXEFkD0qajq3nto1pF4kJhjmBy06ta6GH0dQQLDWjtnSIPWqROJtQgLpID27PX9l4DH3gDdiTqjI527VBguYQbzqDDqPPFKGjRIjDlg1aVBo37vTsqq066FG3T9PneGTFsDSJqyWyP6VNzQbbdIg3YbcwCsdc+3SOG/wV7zmwUfczy/vFQOKvwAAAAASUVORK5CYII=";

const button_green_tex = new Image();
button_green_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAADJSURBVEhL7ZRBEgMRFETJuVi4Ggez4F7SKZOMGSn9Jyk1G8pK0e/rr+lSipo2QggagJzzJESM8TFJ+iO7ANThZdH9Fl0ImjGmrVcSTwRNCoD6SbFf6e2SAqqWtbaVSCnRBoi+il0dv2IzKw8SYwzJwUH9pFQUGM65MWMFjfb5bovwOtHn14vUXa1aYR0dRp8H9+A3qPnaGMC8p0QdB6VJ7iultdeUSAF9psbOVNOuAeiD+foX8R78oNseWQBq4LKIWqS993TTPxuefE18d3eQxuEAAAAASUVORK5CYII=";

const chip_tex = new Image();
chip_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAEzSURBVEhL7VZBDoQwCFw3+y0PfsyDPsyD/stlMwmZtAjoarzowSgtM9AptM26rq/LnnEcGyFYluUiimmaAoK2bZV7nmeOwxnSaULwcWIXCAblX/4WlGImY75NAnHgAAVCpg3DALvCwY6ncFG7QQB/jV1Quq7DWzh0SO3Agp3Dgt3OQJw1OkVnRGYFELvwqtga9H3PQtUcbMFMdgk0QLK6RD66jPISFTttc4lYMV4N8/tfkXdlUItsa8D7L5kBu7AGRiXXJRpysMIsg13JOgNMIbqKzIF7hVaUZVKDcyrZ2UVnVnKR01PJyV10XOTkLtoS+alkbUF1o/ZONFYsqcFxkZO76LZKjtv1VqPn3um06x03O7MbwyjXGXnr+cwXhvhumsnARMdZEhM4gYdDPwJkd93zBVynffXlNmimAAAAAElFTkSuQmCC";

const end_tex = new Image();
end_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAClSURBVEhL5VbRDoAgCJS+q8/vvwzFFWu6ziZq5XjwgYF3HCA5753lWSyDh9iUEJBBokhNbwRbIyBriDMOgY/5nx0SDjoiKBeZdVVlBcRDVCQ1SJ2B6Opk3M1UA80pY8oaoDTzGtQk0KIC3i4uNQngoNrxXwl4Oh4G02VO0WWjxb59VyffIoDJls/JTLNIawa5z7QPYNrLjh138nd+dg14z4cwn0U7SZxM++43El8AAAAASUVORK5CYII=";

const fire_tex = new Image();
fire_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJhSURBVEhLtVZBcoQgEIS8yz3sw+JBH+ZB/mWa6WEcENzdSq1lJQSZ7p5uMMbjOMLXrnVdIwhSSl+i2Lbt5wZ6mqb/E98R3HcG+ml6hIA7yKB/DQmsxhf7nkCf0h4C7ocM3iYgImoo0Bf7nvDU84387HQgiLnYoF0TpxXyNApN1j7yc2gRCohbmKg3c9MLmSe0/lnmqzz6BNOEw6HrhCmDc2AoJhlzQgYe9dan0SdICb3rMhajHA0R1PVkHcQPQvZLRfhZLI7jYFZwlFLCaPdrpwNdCpCCQ1xndy3Xrbz2cSWoJcRQzpCpxiAnpJtn6I1y9TKoFckeaV+IGV2gpbG7qyXIpnP9kQe4BSIqnOJm7LwshjoOJIHZV9sUiFSNxRRYoRTJXKZ7DZODJNoO9NQcIcaYjTEfGisu/rDvpiHMXDPYheNYlkWtLdJysY3FH91maAV7gQ1dIuketB3yf3/nKl1AUKP8LDZKVIKukyls2/J4nDH0T/K+6+vXWmbgROFl8XCwrgtaB7o+Lr86BOA3CVl16d3+vYFVX3MSsokg+jzPpq/NgNBwvzQgMiRPnx4kE6vxHdANekUAaOAC/fmcWU9QRmemcxJr4In5jh1HaK+dJqlFRAeuoV8Fer1UYL5TmffWkjgzaNAhCrcmmTIWKTGgXkJYFZTRW7+FssH8LrIOmBKLfU++M1uANedxEd/Ih11Kr/BddH54GTOedR0zbm80q4yGHBZ1RWCuYcC9dFV9zZBVnmbYQUNAf7qq/cqmqnir53TYgYmSJIYfVSMmm78jeFn8zoJM4LfBOzWfrvkDO+eY64rel+gAAAAASUVORK5CYII=";

const floor_tex = new Image();
floor_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABVSURBVEhL7dIxDgAgCENR8ehwMBbuhU6ufzBsdW6oeal19xp7EWG3oKqGKjJzD51+Z1WAwiISEQpgQCsSEQpgQCsSEQpgQCsSEQpgYHxF5u74i5/AAdbrDdBxSkiuAAAAAElFTkSuQmCC";

const floor_edge_tex = new Image();
floor_edge_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAB/SURBVEhL7ZYxDsAgDAObvot8jQEexkD+RVNRdatcIbKZIRLC2OGUARljHGGr1ioeYGZBEa21M8j6tWUAJExERAQJQAGniIggASjgFBERJAAFnKK/iFJKLt1bZ7b03mEXawJVLaU8Af6JXHP5upVzdvf71F8wHzH3+2uou7d7AZJgWD7uEBa3AAAAAElFTkSuQmCC";

const gravel_tex = new Image();
gravel_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAIFSURBVEhLhZZLssJQCERfLLfl0nSgC3PgwnykjtVp+VwzsBICNPRtiNvf8nq/39u23e93vG6329rf30bU9XrdLa/XS794YFHeNmlgY5db3KSQeDyFx+Vyid/n86nUWBxMkEoRnSXg6C8uYAL+AItgf14XnsqsVScyPkW4HwAw4HYsstMTl+hyI/c7RVzpAGHAjVjEjNMoIWAkNfcnx6xI8RaMuKGzWiONqtC4J3VPNc1W1CkgZalneRYyKWAgleBEBbaTo3DsVVr7GeiIxIbqRXleRG0fIThqHZFPhpYZTUCETZFjRhKnuf2aEXPwPpyZRHJ6dUyyg8kJMLXvlboWW3V9HVWdTzCUsS2fo2IxcO/+WaYLgSqRw9BcK3Z/lRcWKTwsVIQEMcYjO3w6kkbEiQfX0rT46lRPnvshqxycpHSPaRUcnu2Xo6cOa5tIbAhyor56Tuo4JOTlLHrilVeAqHaKomoV7i1rY/NpTUu/DocLhAUTGT6DJm+pxb39S6C5E54ryhdX/ocg8ToP4mdxNomcPKFT5DTDVTaTQEE6tcu9Hr2yyD8V7osgkyEeUi0+TZWHn2sqVymuFstdFbTfhsQ2dR9fNA3w4/Hwealh6M/F4ytAm5XF9WMhO2ke2aKulhhTV1dpqzH3TCfRb6Fp8bq9arHNJbemsrQtUnZXVLvRpj8M/wcMIgavSBlzAAAAAElFTkSuQmCC";

const help_tex = new Image();
help_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAEsSURBVEhL7ZZLDoQgEESHOZcuvJoezIXeS8tUQgjQPxIXkwxxRZp6/aEb03Vdn9fWtm0JgPM8X0Ls+/59STrL/gFmhr1FRrkqrWVZTHWcsgGUbuWk/ZJqAEqJeZ4rf4/jwA5slFA0QD5J6bYdU3qIxEjL7gOoQ7rb7NwnfpomidHvA7pPdS74W33cJwOzQGK4Go3ZqFZ3szXrAFr3s7NMS5UxPQhXBFIZzD6AgQtQCrES/hUDlNLOdyQGKIvhDGIE4JSmWQeADsBFQou2ue5WG2YwRh90X8ZYBNEKi7dICaJtN8V97ZpyRjJROVdlirivD7tnxuh/FTmz0rjmCJL+S1wPjiShSzOTLgBN22Hp+ZsKAEJ3PxvbD86Ybnkq1gcDvN8HpHVdBwL3H7kBSjLLb8lAZTkAAAAASUVORK5CYII=";

const ice_tex = new Image();
ice_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAD/SURBVEhLtZZREsMgCEST3P9Wyb2MTg1RZBFS7PSr6tt1Uey+pbSpnzy86zPU0WMpPcMnAm7v1zU4zhFFfc9TQK2llwK39kUL/f6SuF1l4SvwP12LCNPJ8sQ7IpQdrKOXGiyl8yI3BfQmAwMUj+mETj6e3WvlGQWs9EdmUnwmINM/14nVIJ7eCiyhk4CXLhwN7aJ528s439SLPjdtQK+pKO3adF6J3su8ZxcJxNBRqwijiwIhdBhRMH0aUa2Q57HjrUlpdgH07Iy9aFxf8s7mwFR/a5UXTRySm3P+ld1TcgYvmsE7rYX0GpGtt7i914hsLchKH17T/p8dEEN0S7w3Zq5nusJRTIgAAAAASUVORK5CYII=";

const key_cyan_tex = new Image();
key_cyan_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAFcSURBVEhL7ZZLEoMgDIZLz6ULL+aiHswF3osmBCLFRB7qrozTqR3m/8jrp8Y593psLctiALBt20OIdV3fD0mz7B9QzHAhRWNcRSFtgwogZWxi/9BrB0YGsLQBSWriiGllCABSD9LGvODg8EnL2tY45AiC+jh+4gqMYbgaAR6QzMOrk9w0TdbawGgMQilyYh6g3nrqdL8CKKUCTKaSmgP2VDg3zzOriKmrYZymyDPCBFBh2n1Xtms8L1RVS5QxGGjFUu0a+4faH45MD3znafCDXaGPW9QLh8rIZaCWxVe+ASviAJGzG01sFZEBAYlJKwAoCYyhgYDXjAE/orVIAVUBjrnOGNBebC1ZHJ13MoSCJYk119TpZJ13csaghhZr1gkgB0zjgLlJJ58T2w/4YegTfgmwM2DuvL0fs3TPP7tUN7X3zi46Ni6LHi+PeyLQfOm2CE6Mz/DFW+mOrdu+yC3qXK0ProYAAAAASUVORK5CYII=";

const key_green_tex = new Image();
key_green_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAETSURBVEhL7ZZrDsQgCIQ9u1frwboWEBHxbTf7Y80m3bQNn+DMpO5+c3nvXah/vbb+gO5of2BELq7uZs0XWh1g5aAxd4cLcWYxVUBW+gJAxEwxbECqHkrzQgDcGWdUAVwrvIEL5kWz2gLIQlwdK9KjmSaMDmQVBPB+jwJANg2ABDcm1jyDyMjmY4GXACxNS0Wqs2kAnaeUP/tgUkhVo5EuH83HHzl7TqytqEjyh9LaDXAYXUN00pR9IP8kowhGDTYU18pumatjCD6ZaDU0BCjnoBiUuJbDFwEBqfuo5Mc6wGCAEFS7WwDNODsi3inNCu1SnPNuB4hhV5YRcgaADKXmxD716Wgm4LEOapnxFYAZOAdvfgBRz/N+E2o+MAAAAABJRU5ErkJggg==";

const key_red_tex = new Image();
key_red_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAFeSURBVEhL7ZZdEsIgDISN59KHXqwP9mB9oPeqW9ZGBkL5sX2T6TiiuB/ZhKCs63q7bEzTJAAsy3IRYp7n+0XSKvsHFB0uWPTcR1EotyALoDJqDFWMh9MOjA1Q6ZsIS1gxrQwDQHVKC/buXzmcD6WJkbHIq0PptQ8yHk3afnEM2Lbvv6A6BYdhcM6R0RqEHUHYOqDevu/vL2xA0Qo0mUpqDFArYNQ4jqpiWlfDOLKIjM+B8GIdXddu1xBFMnNGIdsItGb72XaN+mH5Y8t88F5PAw92DQBrshcO06hpYMliqvdfTRwQObrRzFIxGZullmkFAE1QDA8EphEDH6K1iEjKqAKkXkcMyLNxIS0Ro/NORihIieY8p86ddd7JEYMFbeasE8AOGMaBcxGefDW2HxAyDk74TwBlIL1s76lL5/yzC3XD9t5ZRWnhqmh6eZwTQa4vnRbBQeMTvXgru2PrsjeIvM0OTIbzywAAAABJRU5ErkJggg==";

const key_yellow_tex = new Image();
key_yellow_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAFgSURBVEhL7ZZNEoMgDIVNz2UXXsxFPZgLvJd9+MYMA0F+qrsyTqe09H3kJYTKvu/DY2NZFgFg27aHEOu6vh6SVtk/oOhwwaL3OYpCuQVZAJVRYyhjPJx2YGyASg+DsIYV08owAFSntAj27l85nPOhNDFyFnl1SH3OQcY4Non7xTHg2L7/gurUm6bJOUdGaxB2BGHvgHrztoMf2ICiFWgyldQYoFbAqHmeVcW0roZxZREZ54Hwah1t127XEEUyc0Yh2wi0ZvvZdo36Yfljy3zwXk8DD3YNAGuyFw7TqGlgyWKqF2BNHBC5utHMUjEZh6WGaQUATVAMDwSmEQMforWISMqoAqReRwzos3EhLxGj805GKEiJ5jynzp113skRgwVt5qwTwA4YxoEchydfje0HhIyLE/4TQBlIL9t76tI9/+xC3bC9d1ZRWrgqml4e90SQ60u3RXDR+EQv3sru2LrsCwLY6lyV4fVLAAAAAElFTkSuQmCC";

const lock_cyan_tex = new Image();
lock_cyan_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAEHSURBVEhLzVZLCsMgENXSa7nwYi68mAsPlg68VMX4maEOdAiSj7zfiMbmnI1aOedeauCG0GOMWgRADyHYElFK6ZQbwgU6jSoEJLRwqETUOpgS0CQIYY5tvCWfaQ8ggdkS733XP24PIH9dpONJsO9Bhb4us7gm5PseDPKx1pSLYWuzivpwCJoKVqjwOC+hgyHckqNdReNlOm4vImKU0AEDsZsidIDcuxq+/M6RO+jglujEInQAXTvQ1qHcgbANcgfs9QMlf+hAGJHcQbff7fgkPWj3uOf9hIl7HuyE3t/X58F7iEISfvkhO+xgJhGdUP+rMBQFCnvI8fEmOI5btepprwe7RjIF8wORm35uNaen+AAAAABJRU5ErkJggg==";

const lock_green_tex = new Image();
lock_green_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAEHSURBVEhLzVZLCsQgDI3DXMuFF3PRi3XRg80EXmsl9ZMwBiYU6UfeL6INx3GQW8UYX27gxOjbtnkRAD3nHEpE+76vcsO4QOfRhYCFFg6XiGoHXQKeBCHKsY635NPtASQoW5JSEv3T9gDyx8U6ngTzHtzQH6LB1SGf96CRTyAql8LWZBXJcBiaC1a48Ngvo4Mm3JCjXkXtZdpuLyJSlNGBAlFMMTpA7qKaL685dgcCbojOLEYH0DUDrR3aHRjbYHegXj9Q8ocOjBHZHYj9bsZn6UG9xz3vO0za82Am9Pw+Pg/eTRSW8MsP2WIHPYnohPtfBXEUKOwhy8eTYDnurdVP+32weyRTML/mz2hudd7nPwAAAABJRU5ErkJggg==";

const lock_red_tex = new Image();
lock_red_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAEESURBVEhLzVZJCsMwDJRLvpWDP5aDP5ZDHtYKpihG8SJRCyqCaYuZtdhJ13VR2Oz7/goDJ0YvpUQRAP04jiQRnee5yg3jAp3XEAIWKhwhEdUOugS8CUKMax2v5NPtABKMleScVX/WDiB/PKzjSTDvQKDfRIOnxz3v4JlPIpJn5orqDtolq3AYmgdWePB1MD4HTbgxh9sBxCIiy/gcWBDVHp8D5K6m+aPscTtQcGN0pvE5gK4paG3R7cBbg9uB/f8DKf/nwBuR24E676Z8jg7qM+75ucdkvQ+mSrFhfB9sTRSW8MsL2WIHPYloIvytgjgKDM6Q5euXYDnurTVO+32xRyQjmB/8z2huo2K94wAAAABJRU5ErkJggg==";

const lock_yellow_tex = new Image();
lock_yellow_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAEDSURBVEhLzVZLCgMhDNXSa7nwYrPwYi482DTwSkb8JtRAwyBtkfctOr6U4swmhPAyA3eEnlKyIgD6dV2eI8o5n3JDuECn1YSAhDKHSUS1gykBbYIQ4VrHy/lMO4AEYSUxxqY/aQeQvx7S0RPsO2Do+3aLZ8a976DPx3vHz86VqzsYl9yEQ9A0sEKDr4vRORjCrTnUDiAWEUlG50CC2OzROUDuzQx/5D1qBw3cGp1odA6gawtaW1Q70NagdiD//0DK/znQRqR20Jx3Wz5FB/UZ13+eMUnvg61SbFjfB+8hCkn45YXssIOZRDRh/lbhKAoMzpDj65fgOO6j1U77c7FbJMOYH72bfm6ZEw8nAAAAAElFTkSuQmCC";

const missile_tex = new Image();
missile_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAD9SURBVEhL7ZZLEoMgDECh58LL4cFcyL1opoyYQr7tsJNx4YwhL/8Ya61h2dn3PQKglLIIcRzHa5HqrvYBqBEmkpy2jbxWzlNQ124NMr4kgwqOLYDZMk3p8iOqYQgBeukj5vGg64XL7eGO2KlimQKjPe3IGAbv7wMSw4fRD8DeGHzyACzZngJlAOAc9qxg2PVONooBQGbPPONpwN1QqiLRfLDN7MFPCaABtPm93YaUaG1u9gArUuOGhDUAWTaa1fg7D5jNxGPDzNA8mBXN0+mvYcdZOs9BRpLdaNz+kneOZx8wFoEKeXcO954fL7Vc/WWqqvwWWA6IOWenTT7xN62vYeQB/qyXAAAAAElFTkSuQmCC";

const missile_shooter_tex = new Image();
missile_shooter_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAFESURBVEhLtVZbEoMgDMROjyUfHqx+0IP5Qe/VpkYhEB4RgXEcR2U3uwmEyVqrhg2t9WMYuAJ0Y8woAkRf13VyFm3b1ksN4CJ6rABeAcf9u0Pvr2BZFnCCKggswg+vXQcfb2MKHuKsj7VoteN40jmALoHg/0T5qyiA+aB0nvUBNAly/1Vq/40rCMo0UOBwYTJeucE+VarI4wAHXjjKNISeVlFeQSFeria0UaygYL7zLWVdqwJJtveYLiqgMbqsULLz2S2UVgXUsUJRSRTM+lwERaA/Iwsf3jUpECegngO/F9Hwk2WTYW1SIE5AXUFQ/cmyqW1OMgXJ5SrLxMV1EMXLdycWikwBKcGEJXwfJD+JOlquf+X6HeJf6QeZTAJxuXdGVRT35PsHvagnDz8XKQgZB+4h3e8HQXdcH+u42P0RYoQzDvMHYdigewIORocAAAAASUVORK5CYII=";

const monster_back_tex = new Image();
monster_back_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAIISURBVEhLtVZbksIwDCN7ru0HF+MDDsZHuVdXqVLFcZyyZSiTYVonll9y3LQsy+W03+PxSDDwer1OMvF8Pn9Oghbs6QaCFE3TJPvzPPPZCvd3pYJjSJE3EALhaMiENMivbHgDRLcuQPKWZDDjVAQSFNkF+AEF7ve71RoWGcZvt9tb95k9JRZazqdaA2bDpvU/6IKziiAGco1k1BQp1wDVOpQfaZF22cZa0WN9kNag+B92fy8sBhDOiHM1CctlSRkd/wD6bQOExKIzRU0EtMGV3TSrQK3ojAD6hNMxNif+ucTG+LLL6bMlpk1XdCuktalpCAiaIotqHp3QPaUkVGrmyleAFMAyDywEnpG9cgkZVlmGOdKQN1jyYwNsWUTpFm/cBxF7sjMsAnZduIigXg/G8XosdJzC7bwN2BrAtVFpms2sDKC9IWsH048BZN2VWHgoOP3IrEXG0f3rQsYyMQMivRuZIbpAbShiRNt9TaNpq4TJd6Co9/gqufqKEnR21wdZziLbMVBft0LbXetikW/s7HFQ5NLJTXOpvkwRvA5d433J5MD9SKuyKB+yJw6NAl17tre3D4ccQUppyJbBJcNE1bh5jJbaSzX3gchb6smb192/Nvfu2VZ+zadWrQFVOFExih2C5vj1enVb/WeOG/rDb9N+fO/EsLMVGPgKNGPNH14uos/c3NH6A7XMWv09KQcVAAAAAElFTkSuQmCC";

const monster_front_tex = new Image();
monster_front_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAI2SURBVEhLtVZbjoNADFv2XO1HL9aP9mD9oPdinXFwMkNo0UpU1WiAjJ04D5iWZfk57fd8PicQvN/vkyher9fvSdCCPZ2gkOh6vYp/nmfu883PT3UEZpBoJAAQsjJNdh8W2BCurAR/hqerMc+KY8yB0AltNA16r870lMY8BY4c7m4OBlw6u10V354TI4G8ltAAxd9ir1apRBnxl6pECALTp1dD0I/Ho6xm3CfxliZUggVzIkEVLFOHVRte5tXPruNAICw+eFDkgFLgJDOmkK08mgJcVb6qOkYzTAUnMLhehcvlkssUezqVV54QmUYOONBKDC4iIIfXyeogTOT1kAbd91ZcmxHQQjf6ctgxRTpZZni4ye7PbYzLaDQgKu+2aYmOifGNwS3nmCgB6O+DXKHYU5qN6Ns0RJQ8EiW47jsC0iT0DwU6lKwXADnyhFEfhEVznK4cJ4hQkhjRB0iO5adVgBK17fsyF+wM1xMgrRYdsKwiT/IUelrrcSJVK6BZ+KZt8q+rosK1ha4kuao9oGHzoaiLUWESCdgjNmzOAK0dNHxH4/fu0+n6fRAcNi9MULqZ19yuht503yqx/05WRTeBy8OWLWE2DnojmqKTPcNEB/TBL6YWKMufE0GdvA5kIrJQpLQZ2hVfOLfbLbvG/f1+b263C9IIp4XeE/CxF11AC3dv4zRkIg1DJwHm+PDZo3ckvYaUXzm6gFZr4HRJzkAS5Dh66cTRj99/0MBF+7Lb+2I4qMlXsz8mCrYv1ms9fAAAAABJRU5ErkJggg==";

const monster_left_tex = new Image();
monster_left_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAHdSURBVEhLtVZbkoQgDBz2XOuHVxsP5ofey+3QEKImOM6W1BSFIN1J5zGmbdtej41pmhII1nV9iGKe55+HoBX2cYJQomEY1IplWbh2NzsaQCKfAEA29Kli2IxIKSlxxOHH4ICOyyBTPuBiYBPo1qGIw48BTcastpOG0LeGTwApgISZiyZRxr5VOoEH1VKWCGk46Me5dCCXq1jogaaNoO+VAQfhdtmVA3Xm6NUBcImuWqn6fnvxGkKPAMmvtlOTQ8xpr8xxP3MI4Ditxm0rwiG2JGvoeB7a++qr7wE5yv3qh1SWdYLVIUGXH664dRdKxLfLnO1hu8AMsZpWedUp6W4MKodoJQKYsbxK5uJgcZLnQiI9ZjoyHqKYoWhO/Frm47rnAaFbatY1acoB0WMnPvo/KDmag6xj15VAE3CEBLYm2V9pspiv4T60Q0+qngdsOwqdE900bjzoGRLLKwK83ktTaajVKKx3uUh0jqDEeHiRptRgh35oOHGJXROI2vXfmG/LI3NIa9rroDYWF99FpdVkidvQZFKhsh/nGH/2XURNeJ1RBS5/Goav66BoQjgd2ua4U6MCe89O3Pt07HxGvN9voo/jaJnuERDCtfRsO3e+IbBYHTK6ktS1yIR/7v8B6u4PaJ30PrgAAAAASUVORK5CYII=";

const monster_right_tex = new Image();
monster_right_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAHmSURBVEhLtVZbkoMwDGv2XOWDq8HB+IB7ZeUoMSYvQmdgdrqUgGRLVqjz3n9eO9Z1dSA4juMlim3b/l6CVtjXCR5INE2T1rXvO8+rF/U2SDRKACA7Ds45otgJwSUl5uqoB0Dnk8C10Nn84attiBy/eACOrHC2E5u6js0zAqqk6EDEHy7i4Ek5k3UCdFo2i7jY2hVRY6TqWZoKgUCjFH8KCgNImVUofN5rKQ86+NSinekelQkc1doHTE5NZLXTTKtMDEVtV6hIJBOJSBEmcWQTYpURAYPD6CPLQXNMcZ/cGqckzE0SSNIUAsFYaJir6Dc5iOWk4vEf1lCNy2fIYFn7vQcyHng2gMmcG6WhCb7JZxd9IMnfaJz1gHseda8m5iYHXI7l4yxw0ALdTu3IW8PLOWomWSRI5Yuf5lE1eeRVOLAXcZaSrWyCY2W3k3Jr6Zkco8A8R7DUApJxhkQWs801U6nZwSVupDlfaDI8Kppw/DamZ9xsVWmbIkfUL71BR03W++LOSpdpA7JxhWtFjCC9d3IF3Y4qzjlprhnj3jv5zIEaAA8kXSkUbOjuN9vdmOrzxLXvBPIlxVAsj8yGO4lK18KVZVkaK3J5nmeuDv0uKovqQFv0UQKtpY+brbIJ6aDf7CPQ6s3/fL4V4hrJn9wAAAAASUVORK5CYII=";

const player_back_tex = new Image();
player_back_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGESURBVEhLtVZLFoMgDKw9lyy4mAs8GAu5lx1Mm2I0JNpXngufwky+E4Z1XR9/W/M8DyAopXgoQgi8bVkWz5Gcs4uAoFtM4jJpQPA0DQE6oFNK7U58wdP6pOHYBKYF/Q0GAZnPiyLDufA44fUgxinntCHukmH65yUAEDhEqk10bLhA4IE77rEJmuqXxzu/eKtNcM9wPvX3RrMJajeRXg3D1xsq3neHL59Wl/phS8UbvS9WIZCgbU2z4zCkwoW+OVXRlVypSZbox4ppvoRxvKVFHBlOgxC8j6jCBeTjVFzPPajmczQJRUuD1QtqiNZxrPliu5QgVKvBoZjfkwo55gpqFK6Ip/oGjs7kOfcABxClXdmpWTQ6XQ2RtIvHtlaPV8v0Rwn6TeyuhOuamqa8jX6Ey83hJQA0nmmqQ62iuzlcBEg4oLG+lxc0YnHdvVwEVOyMnma8Js+lqNdoxyqKMbYfxVXsltgdDoGDwsV/oPhYnZq2J9rpYYqPcEK4iA11ojk9vd13L3/k0899c1hvAAAAAElFTkSuQmCC";

const player_front_tex = new Image();
player_front_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGcSURBVEhLtZZNroMwDISbngsWXIxFOBiLcC866aTBpNgxfXoWqihK5vNvIOz7/vg3W5YlALBtmxMxjmNdmVLq7lrX1QugtNQky8YA8Ox6gQVQh3TjcYwRT2RMl1IugMcJbU0fQPe/bZ5nJs0Oog+gNDLeXOgOUXI1SBcAQpBrDJIehgvAWUE3hxDoKm7Y3N0xcgGoOwxDlcMN/pJqt0Af0HQ6YORBGvZuAWvi7g7aofUZPUvdmuS6v3QhyoBsyL7hIRaCEYEKgCjPqKxOISPXepaso+KoHqTtSqZkzJpaZBxl47tPin0PlXyiM64BOa3YD8fZITVRsiW5pmf9Ni0qWpYqQwlCBZQgagFluoTXXIap07rVigCbjxbcMFy5LueroIx5dqSIIqLeTdrhBLpIG2k3oB45V3U9xXrmuwF6BH897D5ptrJkMO5E4P24OeHcAKj/lCU3AOrlbdab3R+LHB74EIprxPb8y3lwmDcCiEu1DDs/0VheAPfjWwi6/CKi4cSHGZHce2VWr8logpimqSHlN5ozUke2r5e8AMw7+WSX1YdoAAAAAElFTkSuQmCC";

const player_ice_back_tex = new Image();
player_ice_back_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAICSURBVEhLnVbLscMgDDSpKz6kMR/cmA+hL79FwlgSEviFyWQwiF39IS3nuQwHttNYYribxgQKPQmimVqNdEJQ5Qj6+71VXVea9zQ5L++3NOk1tz4lQO/7LiWxUvikTdju0LH2gGCuAkl46B0BhMwg9dtgz1T/sNPYiABdE8RCkPt8tuPYgQh0SanQe/1KBnKgInRtQe+tYs0QgWIw1P1RCEYuive4ApvHffVn+r1M2jaUfxQwJb7fD3L2C62h10lUaAj3he60k+obhEj/zuuzTop6JCNHrbSyVMR4SBwI0Ke1wNEdcl7+yeoAR855Rbi65qEq+Rd04inoQbbdBBP0PpnEyqobnOSqLrLoEEFgW8my7b2jZFl7/gFMtaDlQJ0YdE52dwzKhOSD+yAlFTfwRRZgnftdF172StiuETelMSpmQSDNjyzj7NTyzefxjXbpVUSLBcDqfBR0OtkFfAtK5ZBet2hD7/NRdzPTYxwCJ6OCHOcSkN1MnuVDluARurzVRQW4Zy0Bp2nUSveDrn64S70c1JHubNzsanpQueFVcT8sgIE1bnEcKtMfG2Y5i4+r80nRG122Uk52+vtynY/Ri7xAN33b37LW1G7fjDCahTeae1HLO0E+xazfW2rlHFSyd1FXlPPctk3m7QCdMrgLsrtiPcAMIgChe58QWPSpTiKufwHqL1ct7TQSAAAAAElFTkSuQmCC";

const player_ice_front_tex = new Image();
player_ice_front_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAIOSURBVEhLjVZRFsMgCKs713a1fexq7b26QNSCIi2vb8+1mkAAtWznuaWGzyWfkX4tOcGIXgzXnWfkvSG4nFPofb9efD46HmiOY3u/bUivR9GXAmiLjlW/30/e2JgmdEx7RvDEiwh9kiicpO7PBon4XrTCyCtj5kNEPpjUx3bgpe8rT1W/cicIN+gth4ALrfJl/iXfFFIrRWxXbzlW3/c+XkYvM1fKEOguArLG2uryZR/0FpNBKfRaqkLrEn8PVIRk+EMn4oY/jpjAoTdgytKTLNCt0VboWlpT5VhlrkZlqqw1Aev8AacpP0ZQfVFNIEJXYFNBYlOVVnui62Q7iRKLYZCgsxeYmcguAqu7ZA+Pbc66txkM+0Y5MoIxq4gY6+F43w3mzRmfZtaJpEbQ2QM3iLJSqXMsgkjPA0YN3zHA78zBJpgrQuOgKtl27eoVHaN58U+N7KqIJlHX/Gkniz9zoYKOuemxGt/JFUcQdHJH50lpDdLZXctfEgKCAB1w7qA18P6MGmo9iCBGlypacJheCdeOEbBMg75HBOvNwi4Z1mYSVSFYnasIvEOjZ7LWn2jj1shNkR7CuJ/il4+8b+eSGbhjODvt+mGnULgIwTi4stx26diz83wtrxu+PByoISNToAyTfxyLTl7cor7fL8KXX2MJenyirW5HVNz2lE3AuOqSN7xs+ZfxoZgsNDeVP3x7ypaffd0QAAAAAElFTkSuQmCC";

const player_ice_left_tex = new Image();
player_ice_left_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAG/SURBVEhLtVVbksMwCMvZe7UcLLUNyDIPu/loprPTTR0JCVCu63n2n+d04IDwX/RW3FGBP3DRFcXddzj/uwMDuSHgo1S9zFFoRH+hwOpmAvm+Q/cEaQkisZfYLydCCXYPwqItughgjo9dBxHakxpdqhZoEDRw34wKIW8OFez8SY3SNqTzkrS+j8othas+vkNGSRnTopwg3r2u4cCY6AHHItgoqBEHk5Xq5Dmt1SY69L9G2pW5rswiHJSWGAhmLTySK02nUmtMYooeFw3ocEYXF7sKRTZb4kGZiWyRRzf34ZELivy8kwKC/DSmGwrc/G9q1/pWgYtStzsYSXDwKO8WrZowL9aylJsvHD9lUZXb3FVOav6ePWtjUuFiA1qJfV3GX/5ABxaaoGjWN4VHUBAwutxErri2p5usQeRKJnRdNNk1Zo1DFQnWTbbquBMIqxkj/VhLMOgoLVq2IVSHcJ2rN8hwCcEy66VFWONg8fKIESjla4sqETwagp0mksY1rQk3oHsq41H5u0mB9pPGdbnii7loYJWa/v4MsWoPLO7n+NS5VqKXb7RM1uvaqzfaYa5WxeV75mxRGiyb4OKfyIAvCLjVUnVzLVoAAAAASUVORK5CYII=";

const player_ice_right_tex = new Image();
player_ice_right_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAIkSURBVEhLtVZJksMgDIR5V3LIx3LIx3xw/pVpISEEkojnMJTLISzd2uVaPp+yHdiu+xPb3Z9/RQf4FwKRvdaiz16i93vZr6mJgAjr4V3K6/XC+/F44n2/N4TQsEC/3S4T4GCt5znOHwfRPJ9EE3BE6IQxybIcmglY/E+TvbJ+OhL02Qd/Qm8kgq8XnQMMQS6CdyqUYD1oWHTngE5wAX0yjrcMtBHve3ngR4jjn1Ksh63UmJ+8x7fod16xaDF6N4Li8kSHRQcC+DiUVzSSIxKfTNxFWziAJeJrsKqmC1SzTZBoWnxo0kLFIt7V1orb/LPavvt1JZjQ9ZJGZGOjZYDqhHVNauJEEKNDFoVTStVjiz4l2h/QG83w07aeSzXdoVv7suDN6NokZBKl8dBgPc0pyt7Tm95QPuNcnuX9gPM+Q7ftISkEHFjbfjDFzCwb2NFa8GbdWVFTi9TmCQFV4wYBm4+4dPrzAtMYV9mQjUyk6B0QkU+5xr3Mj7lLLgnhCGqlqsJ3GLFFznEcsoJ/+jAZ/nbxbTTypjMRE/RBDbJ3ZrE1fiT1+qFOEMd6WKhxFTSjQPqSjhPA447dapzknZn0Yu6qqaaoXN6g90+CFF3KtYHQo8IftiP+kGH0Uz5qrBL2bqUojHopXY4yiGu49RMOwlWQbPrCHHfDfonFSPahn4aBeGFuuno362hf0GeZUqsyTdaTl/UVpXNk60PEKwQpygXz/gJtlBIRavfbQgAAAABJRU5ErkJggg==";

const player_left_tex = new Image();
player_left_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAHdSURBVEhLtVZLroMwDISnHosuuFgXcDAW5V68cSZxXOIkUKkWQhXEM/b4Q8fjOIaf2bquIwj2ff8RxbZtf3ehn8au+N7IAMhAfL8zbHiAJ2+8wr3ku5EB0U8GTFw1dB6+IRGqBfOIWlJdImD44zjirhzbtvBiEjWSSwTEtQ0N3Hl+8WqX2idgp5SemsTr1cFVX4eARQtSZA6dFSsU3ndL4meA9hLExMFGLIXSsrs9yiT8OYixo3zThOLyKFEmPAkF15Lgd40AgbYGTWh0fJIWFiuNnjNijKlDgBOZAwRYi9DNqN5QRgk6bSoQWkruRI6vtxjcfu3PAThipEH9bKny38xB6SMcrLZtzM9W/jKDsxtFo5lWruXRl0j3vxXng6OpUYsgLgx8UtGHvA+IPVz4bbT6ZtmJD0H5PT19VcHCRpJZkWM1jqZEtU+1zF/RpxWOKkGYgKRuEiYqFEY0d1Q6tixLmcej3cXxrSged1FQ5cl1zSUI3CHQudYiiEu02DTuhlDKE01v2UmcWSgXmrJIHsMwz7MlaP2riLkHccR/E3/XwEp0WKyNOdcZNOCK1dEJZQM/cVyQKIXjiuBGrXz974HrryGXglgNQXOJ4FS0aj9+vmASQqD1ueh599g/0+5AAJzyvowAAAAASUVORK5CYII=";

const player_right_tex = new Image();
player_right_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAHhSURBVEhLtVZLkoUgDNSpd6yZhRdzgQdzofdyOmnBiEBw8SiL8gPdSSckjsdxDF8by7KMINj3/UsU67r+9ED/mdGz3q6pegDMbdswY3UIAfM0zZj1xYBPPUzwoCWRclw46yo08yw0nRy9EhERHmAgZq/yohqDzHyKQ+hxHPVRxfJGV5AzkFdO9BJk5meUzLKiMw4BdvGy4gDIHh1A42tKuYymSqAbBNeGND0yic9I6FFFwhQ9cNI0oSOwvKftlyB4iTeqz/NwOOcgAdmdF3Q6I9Gbpwc+AffcAkhcmBxvGqf6zUEDHK80NPpuzfDTVMwvVR5Au+gwxk1TyaSb1apPDzR3tQjEdiZJDEXRlXax8CSqoKcG4ZWiuge3zJEwiDTnhXvIpnOjSLQkUnEUIvYXAbeDsmGONDVXChKd6KZPA0SiWivPzY6eEwBdGiT3EFGdOEtNFOlU6wx+q4N+iq4F7Y5DkAZpy2TKTj0cboBlQU6QNXpilLP+V2Mgp7BFVa6mEITNPf5PTNbaW5CaPxnVWjRNE+wiOgOQlfuw6Cegb2JEoz+XY0Bc0FjcnANxAkupzXAltmPu+nV8dqv0d0RT4ATh7Era10WQhOrKm+g9+bxaZCBhEc18NcYUyVfb+hf/A2zXRH/G1VUYAAAAAElFTkSuQmCC";

const push_down_tex = new Image();
push_down_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAADfSURBVEhL3ZbRDsMgCEVl37V+/fZfdkkFSVW8Qn3ZXtakck4vtFFK/Ms5y3X8goguSPnTxIhJuALsCByZWi4kmJoMrrPJv+5FGui0/nsZpQ9HPB7NylglEH7EJI/LtJ7AYWq46jsY36stG2UCas0E7VAuE8BdTBAY/ytQC5VuF1CSXeALPRG66F0WKoGURkzMVUM29jHc1HAxwTTTmLsouJkArleAjriu2/6abheQ7LHUO8Kst6RUZP6+qkCNxTrL2ErhVppxSsAztVxIMM1kcNcENxPCdQocM9/+mm4XnM9QQpda+GiAAAAAAElFTkSuQmCC";

const push_left_tex = new Image();
push_left_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAB2SURBVEhL7dZBDoAgEAPA1nfp6/VfK1eTEi8FYiPHhgR2ILCsKqhBUOa4dIxD51tnui1etIDLp/kvqsB2AoCowOjTNppH5PXJI7L7hBGN8JlLVNA/D/bOy3TqnHz8VGFPxQilMKJ2LexKeUR2pe8T8W9+35rAG7WJKD8AYUAxAAAAAElFTkSuQmCC";

const push_right_tex = new Image();
push_right_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAACASURBVEhL3ZXBDoAgDEM3v0u/Xv9r7mCih/YEJbEc14TRxygZbJ1E2HG9oqCw0QaTBH2DKmwtDmLhwvWMdEXUvqSU9Jc8aRrpNo8DHSUbRLpZckIkorQWUSZOxBj4fNY6UMTG60DBp09sg0jExwaRjo8FIhI+7W0gf76J8P+HdgNGVyY5H6k+BwAAAABJRU5ErkJggg==";

const push_up_tex = new Image();
push_up_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAACkSURBVEhL7dZBCsAgDETR3P9aPZiVZuEiyTBpIgituCryH4YulLF5yeb+OAyQIXOnLk2d1q7djISAqJuSHIDvMtICKl0g+cPtxDpb7r9wGHCJzB38tf536rR27WYkBETdlOQAfJeRFlDpAskfbiP2NUCelRogdVq7djESAqJuSnIAvstIC6h0gdSb/Wv6TumfQ/T+qUrMu+rNnfiuPYnuVOkC6QYxcL89YvPe9QAAAABJRU5ErkJggg==";

const raft_tex = new Image();
raft_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABISURBVEhL7ZSxFQBABMU+e930txgbpNKloPSIUD/JxrvKfVp9+y4noP25A/Rbi/BOtUiLkIAWIQFk6C9Chv4iLUICWoQEkOEA3BkIr+7/FXcAAAAASUVORK5CYII=";

const ray_tex = new Image();
ray_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAEOSURBVEhL7VZBDsMgDFunfWtPKwd4GAf6ry5SJJRBSFyq7lCtp3ZLbOIYwrLv++OyJ6W0EMG2bRdR5JyfOPRbPHgWWgGBxxgrbgihlOLSoBU06IRLZPSjS0ABvkQ9OuOCHA7BCB3nsAhsdJBjSICgIxy6i1T0sK61qzGlpsOqr1AXEZZE7z8NOykS4eJI3JGpfJsiZj9QwdzyjW7/vIKTgvTpaAWNL3ubjlb2tQ/ONEA9aA/sg2npUIn+BNMKuIlOD+iMtCHcgNconzNpsvPslROfU9wADtMr4MOd7w380qzUDajrVgjU0SE53ACpSjvRSBDjwsNy2QHyX9rJ6MXLdYsacIujYun9N6fGKOsDFO6vzY52Q7AAAAAASUVORK5CYII=";

const socket_tex = new Image();
socket_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAFgSURBVEhL1VZBjoMwDCyrPgsOPKwcyMM4kH+xI41kWbaTuOpSaXuoKExmHE/GZbqu63Hbp5QyQaDWepPEcRw/N1EL7f8XsB4sy2Kadp5np419fOzBvu8g5XfGoT7+6SnWdZ3nZZ4fpex4KjVqPV24waNqrMJNMgcmE0GQVEcl+eCn7FLjfbmBAHhRe60nVuKa37oPvNZPBZ8S0CvfvU4JsKev15ZnF7wXCEwGLxymB9TwZ5FE6BUxgk8J0ANhp4fgMou3bROM4FMt8p1ppSGDHOSANYqAnG45x9TQuTHVDHLA9cMdiF6qRT4HLQHtAXOTEsh0lkQZZJxkk4PhDjo5uN2D+BT5HODU+31kchAnWaeMk87caU2RlMl/O4tSHgynXicHAw/C1ps+4L+hM4sCATM7/ZjTAqigNWsJi9/swky20hDe54ABT1agM5FIZGQGAm8V2wF/49106nv4+VZ+AU7OzIwvlC4PAAAAAElFTkSuQmCC";

const spy_tex = new Image();
spy_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJwSURBVEhLtVZBkoQgDIStfZYe5mHjwXmYB/2X20kDBgysVVvLgVKEbtINifE8z/Bv7fP5RBAcxzGgmOeZX/d9R9+8jve2bdvXeAbgBPc80eNZ0PGEEX19EvmIgOjzNEFE9AAlIoDl6RnHbxFM034cMQRwEBQaCQf4nrXWgypwKHMcwGIPDjAFNQxk0Hd5vchXHGpIWw+s4qK1QWcc6AP4NAKgr9sGxHVdKZfvCk6R2kYBkp9wVdTQT72euNJnDj4TjU1GLEGDJRzk9pgSOp0nVuazBJXJjSZJDdVdTo5RDCPQJ3kAXH1OI7UPFwFPesMhDmMBdc9MIUZ4uyyLOFyj0xXb6gh4tGMsJ6fiy0yVYtntFMGy0M6rFQ+K1SU7DRz2XakdpsnORYtQQBujwVl2dKtPMOZgZrt3BfEvGoJAIsRnEfpxuxM4ya5Mer/fLjIP+/PWzUWIABwNXHltxgdFxa8HvPRchmohEucGVphkCSijawAWfrvB8k7w06TtPu2FTKcpr4fOJb5EvWKCaMoZIzdRBsXHIcBsEUeSqVNKUwprIuoXHz8CqTDTBI0iSG40EIf64CCIAZoteueq4wGkQIVRBcABo3n9ixQ0WdDPcwWN8rmt40GulNg+aBiNJNTcGvRBBD6BzQ1irCrGCHBspFiavbtZukQzisDm1JSeQoD65ZKXGsAI3LNUEZS6es9uUuvnmdIjJnlATjS5WrbsVmama0Z05ed7pWyyPBfAYa2UXGyrJtFSTebUNvtbjgxBoKsvuLbu54X4mAl6fw9jDr2M7V9F3jW3e/1VdP9QehwF/a6P2S4IqrzYuyx/Gf8BMzgfmtxFAEwAAAAASUVORK5CYII=";

const swim_back_tex = new Image();
swim_back_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJJSURBVEhLtVZJkoMwDMS8KxzysTnwsRzgXxntbnnL5DCuFDHGbkktqaFs7/f2n2Ov4MWmK4OlbPEDt4ZHdLFYBPJPZ7fYi3PeyPavq6Ieh8w7AgjAXeXnO98pOu+Wh74CwRWCPs8TuaQVtieG1dX8b7c7gyq6Drm1FfQEsUdzjgT3+xxy0Bxz8sjHnhnjR0mTIGYEjAwgaWD1+fx5vU5CJHQ0mRxDAoy5j2WaI+jp4Wh6EK8Rj2BE91cNct03FIVYFMxaRX0RhNFgfOw+ZeK+j8eDbXQ1matIE/tN8ahJRafroCYZklH5RwNvebGuMJDWvnWAlTXvuWjJr/WIIwNKwDUT7g/1Awba6dHduaj2erIlicqcoDGHw1SQDWVJGDZp4CR7/8aplIK/oMtJQ2fsJA1SRbO8Nuh9McEK+z4a+0xDbHMwQ1h9N2lbL0bZ9qmIkvshCIpy36rWeJUizbaVYm8I7+ROQ5hMqm44T3Oy01wtoRoE6rxnYq6m7HHtfqr0YzsYXazalVZQ9hrlN+pmtR+MewdgN606q+2h7j61tDZ57tXeUu1/1ILUyagKi362rsna4G9BVBqeK2arQh26HdO4QjBm+jPStKpF4UL1BcQOHKQCTuo22A9ceSyrbIvMobKuFTRifb/5zcbCNPoiSqrHL077Kjqwe/v2zo1dCN7UzUUuhDB2mqX4BFKnVMFUr9y/7JM238IFDAv9KujWigM69Om7aPQtZb67SYt48lU4iiC/MeIVXalr8rFMw5KinK50F/n4lORfJOGsYSHDHfUAAAAASUVORK5CYII=";

const swim_front_tex = new Image();
swim_front_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAIGSURBVEhLlVYBEgIhCDz7V5/ra/WvC1hAVDBzmulOZIEF4dp139f5atf1z3ECfnRwUpZVIjRxxo7x0a0KcKCk/y06OD2T4dsAHdd3AgerD2zgUJktVAEWIosgTUOhoz6OIbKLGQG1AZF0ncp3oWtDQGZg1XFa2KCts/LbUhR5E+j3u289n6i5kJOMIivTWHzuoqO1RtARnSSv14t3EBPUe6C9oB8si2EES5GPtAgCXfZoaAwjxTBSNCUWWuL+uogi7DNXu3yQjMX8o8XP9sqbopka4MMugoqrh4eDJAtTgFtXA48iTu9B6EVTboeCZPTP56NwjNXoNRp20uekIq5OzhomCqRYb9CXkYNNKd2f7aU1pwhB0CsieFKKrV0qznjnWbNsopFyvWi9nhgavm8WnIllo1xBR0X2PBWTSyd+tPa0LNNexGERA4OPQki+Ikux8cnp3ABSxxT4ddoRIceqOs4FxLgTAq7TyxY9gI2lqy8R+AnvRFokci/WdqpDw/LkgRpOn8lHnwuH8yD0NDXUR9LENY7uEzCNgXHAPaTLzf2ca9tafEcnY74Pk3Ymnnc0KXRUUTVvI6HnXx5Ih1lnbM1TmEfIx/SFs+epkkqriPEuN+XIknEw+KTDdNNMCurmyNY5GBSTeaDB1l+iMe2eRCV0mvBFq5AEnH2J/kzMwchcMP5K/hdXEpgL1fHLDgAAAABJRU5ErkJggg==";

const swim_left_tex = new Image();
swim_left_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAJASURBVEhLpVZLdoMwDMQ5FyxysLAgB2NB7kX19/hXaMrLa41taUYaWSZN5zndf9I0/WU7OX5k52Qsz9BDEjK+DVllE1jVSTWy/wkJVmMCPt15UIkZQKs4mJubxvdzGTs9gq7pIOOdPOnOXgJAgwqjzbhnplBBXzTfqJ6PexGITU5aG1zLd5y7X1OkZiy9P+Oa3t5v2rSuL4sjp4ts2Ez+Vj9xexz5ZzgKA1bbtp1hW7p6sDIYRtBF4h6AgnFMhpFjM7vPp8hWooMm7G25TBiRomdZLoqTkrO+Xkp0WuZK6nzQCmGdPgfOjBMR3/dNoZ7PlVFDDyykhsxA5JTUtcucKMvkN2ZqgLa9uMgXAMQdg+gDIGv3C4dR1IcasO3HcUQQKkb4YZ01oYPKKZeiqtQB2ZADcad+44kZGhC84bXFXc5wBlgkSUXCIlsW9TLPs+ocQdDYqNB+UsP7sR8xX2Wz3K6pTtjd0lRlJhurQV+jCAwh4ng2AJGDF1QPeS8g0bVSEXzew82LvHEizYGAQTe1ngE1waeME6UPFkuwptl933mJ3NELHWQaQBeQCNq+X3R2vMBgrIAYd2/cnIPLXl0Ecv3iKYoeh61pZK4kslQaCuxWLWSmuZPznJkVN8/gEs2+qwTkMpUtcb77XyeqV+/iHXzNaARdkavkNLx0vb5WATsgee4LXtfi+o6HsVDE8nZD4W0/KokgUb3VZKVBzWsgaZ3xsTbk8H/fRR4xB9DLgYv8naT3dLjxXdQ4+qUoW9Afrwiy2TuppXUAAAAASUVORK5CYII=";

const swim_right_tex = new Image();
swim_right_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAI1SURBVEhLrVZd0sMgCDQ9V/LQi+UhPVgeknv5ASuIv22nn5OZWpUFlpVkCTGGz8cSwjfHCfiRwclYxhBhkWD0GB+dmgAHRul38QFWc3IcFdBwbcVx0MbADj40nnE5YE8z6JoObKoY5wS4GlQ+xoz7KjBrcpIX4VlXgNfLQAD+gbShg7lqlbcOUd5QjxUUHa8XPa1wixVVcUHUlF6yiMTIcRyRePnk8aKsznMdCEZxQnzISrJIQd135zbxHaGSLfRcV7BnkZXsUdDyf577VmE71x22tb7TAl2NbdMFqKJpA1IDw0U29KxrIB8zmtmO0JkOC9Gjq+1AptpHckQS/nkeCPj53IEutHVah6k8OZhpDomX/JCnfd9z7HDTa8xiPeqfuskRlg58+DmPqpyAlW2nTj/3EgysHBueeppf5V7WOlT75hFUQBguJjYQKYeQC86wNBxxqFXFIy2SGYlKdo10Yhzzmy4Ny2nzCcZ1tZLYC6eZ4FpVyhfZe0IYuhzY5XVoTNqmFwDdTPRS0uXF1oDwnhwon1Gs5Khkwr+T5dJTxhSBHDrPM9WV/JWREi5GgY77gKLq0AyMfe+/qkpxodzlEiIAkFYNte5FFZ0IyH9IDF6i2a7xVLwPLLE0QQMts+1+tlTdrOmm38cFp5mTJnXLWxQjOnJ9Lc3fvBR7fLZrj+kHQTrvNdGHtZL7bVpkzfdaoCq6/x1ZZ+Y00xr+9l0kMU44EI20GTRSe1vSSTmmFA3svir+H0VyvGVX3CgLAAAAAElFTkSuQmCC";

const wall_tex = new Image();
wall_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAB9SURBVEhL7VaxDcAwCEv6V17LwGMZeKyuqOhSVRlwJzMw2saxAt3dG63GGAcNvAHdzFgEgT7n7GnRWqtqGuAGOjqFAEKTg2KRJtjJgt7g2yWlSCnacUApKnRJ++DVTP1FOxn7b6M1HF5R0IU7qbzfBOW4j1ae9uC4iuFMYp75WTDSopyWGAAAAABJRU5ErkJggg==";

const wall_blue_tex = new Image();
wall_blue_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAACQSURBVEhLY2Q4fJiBdsDWlol2hjPY2jY1NdHMArDpdXV1KBY07d8P9BDlJMTtQNOBJAMoDsAIxKEeCXIoyHQggFlAC9NHfYAnVEfjAH+ahofPaCoaTUVkl06jqYiYmmO0LBoti4hJJ0SGEh1bFdAmDKQhQxkJaRGhtotgfGQ5KrHB7qWSWVjMAQUG7UwHmgwAAtXSKufrRbQAAAAASUVORK5CYII=";

const wasp_tex = new Image();
wasp_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGJSURBVEhL1VZbCsMwDEt2rvWjV2sP1o/2Xp0SbcLk3UFhM2aE4ki27CTz53m622xdVw+C4zhuoti27XETtGB/jGCaJqTG30G7UAFw930HLn7HOUYJcsRBjlEC5m4l4peujRIAGgcGmHbRRUdAi0AiEBT2fDotSEaOhlxVggBa32mPZjtySCLI7b0DqDxmHcapq1LrqmBqPmLko6kvjFmWZZ7nhK9zVYTEncN+agX15WwA8ofX0ElWlgib2TdysIhEoqBSdE1wsdUFiagMjLg0ZJrcD8kXdkN83FWWSFlTnLdEWHwkgj5Bosgqt9XYTpQlAocVJ3TCPEs4DXBySCg0uThUnTHVFNkGcE1jHbB8hBhQHVM7o7VXFTQ8y+xHXkF1TIWOwrE/T98WgRjWUZyijkQsnKInbjvZWLckUsnxqSmAQB+WiDz0HNm41klOBLXpJ1SssnYvfXPZvefnk35bqwv/i5IeSpwGASS6QEAg7BFibfYV8A3B4PAom6EeXAJNgv+fwHMY7rMX+RQYbE0cD1UAAAAASUVORK5CYII=";

const water_tex = new Image();
water_tex.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAFnSURBVEhLpVZbAoMwCGt3/zt39oHlFajql3OQQoDQWlor508tJTCvHaxym1p+G/z6YzwQYfgXMuum9/v1MtGn//hJX2YG3uH7qAG0/Bnu/oI5WPm8cxawxIxJMqgBYFxBxASwGqg0MeO8Coxrzf7EmzDy+cC4rYV3QNy1gOu7fZY3mRFFIm3cr4y35cEc96s06xSJLnIH4ZA3YyYpiqfhfOCZJaMIjKKF9UfdIxl0EY7UmQDWjEqFphA4XeTOEVSorDbrABhaKlNZYUa7Iv3MolPgbpS1teZyl0XG/g+WxLUPrILH0DpbJFl6H7zqHD2hA0QtCaxF8XY8ZhDINdZqQdGBgpkD8HalkaLgQRBKBImiR4Sk7cs0zexkQ67o7jSOWE1vLH+wsdYGQkASGt++Uk5w3j1nex2b4hEJ1HGbDqmQ/WGvU/lJ7qIeuOHSP7wXhXvw270oGxqQwfOSBhV5fi+Ki29Y/QNUat4QpRaWWQAAAABJRU5ErkJggg==";

const canvas = document.getElementById('myCanvas');
const ctx = canvas.getContext('2d');
//ctx.imageSmoothingEnabled = false; // TODO: find out why this doesn't work

// TODO: show inventory, timer, number of chips remaining
// TODO: place chips below blocks
// TODO: buttons that move creatures
// TODO: show player facing which way they moved
// TODO: limit player's ability to move while on pushers

const fixed_dt = 8; // 125 Hz
const MAX_FRAMETIME = 250;

const TIMER_INTERVAL_MS = 100;

let sq;
const nr = 23;
const nc = 23;

let width;
let height;
let pressed;
let paused;
let advanceFrame;
let simulateInputs;
let accumulator;
let frameCount;
let simRate;
let prevTime;

let cs = {};
let ss = {};

let inputsToSim = {
    // 160 : [ { key: 'ArrowDown',   mode: 'down'   }, ],
};

function saveState() {
    ss = JSON.parse(JSON.stringify(cs));
}

function restoreState() {
    cs = JSON.parse(JSON.stringify(ss));
}

function level(n) {

    if (n < 1)
        return;
    cs.level = n;

    cs.player = {
        keyg: 0,
        keyy: 0,
        keyc: 0,
        keyr: 0,
        boot_red: false,
        boot_green: false,
        boot_flipper: false,
        boot_skate: false,
    };
    cs.wasps = [];

    if (n == 1) {
        cs.map = [
            ['     ', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', '     ', '     '],
            ['     ', '     ', 'WALL_', '     ', '     ', '     ', 'WALL_', 'WALL_', 'WALL_', '     ', '     ', '     ', 'WALL_', '     ', '     '],
            ['     ', '     ', 'WALL_', '     ', 'CHIP_', '     ', 'WALL_', 'END__', 'WALL_', '     ', 'CHIP_', '     ', 'WALL_', '     ', '     '],
            ['WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'LOCKG', 'WALL_', 'SOCK_', 'WALL_', 'LOCKG', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_'],
            ['WALL_', '     ', 'KEYY_', '     ', 'LOCKC', '     ', '     ', '     ', '     ', '     ', 'LOCKR', '     ', 'KEYY_', '     ', 'WALL_'],
            ['WALL_', '     ', 'CHIP_', '     ', 'WALL_', 'KEYC_', '     ', 'HELP_', '     ', 'KEYR_', 'WALL_', '     ', 'CHIP_', '     ', 'WALL_'],
            ['WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'CHIP_', '     ', '     ', '     ', 'CHIP_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_'],
            ['WALL_', '     ', 'CHIP_', '     ', 'WALL_', 'KEYC_', '     ', '     ', '     ', 'KEYR_', 'WALL_', '     ', 'CHIP_', '     ', 'WALL_'],
            ['WALL_', '     ', '     ', '     ', 'LOCKR', '     ', '     ', 'CHIP_', '     ', '     ', 'LOCKC', '     ', '     ', '     ', 'WALL_'],
            ['WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'LOCKY', 'WALL_', 'LOCKY', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_'],
            ['     ', '     ', '     ', '     ', 'WALL_', '     ', '     ', 'WALL_', '     ', '     ', 'WALL_', '     ', '     ', '     ', '     '],
            ['     ', '     ', '     ', '     ', 'WALL_', '     ', 'CHIP_', 'WALL_', 'CHIP_', '     ', 'WALL_', '     ', '     ', '     ', '     '],
            ['     ', '     ', '     ', '     ', 'WALL_', '     ', '     ', 'WALL_', 'KEYG_', '     ', 'WALL_', '     ', '     ', '     ', '     '],
            ['     ', '     ', '     ', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', '     ', '     ', '     ', '     '],
        ];
        cs.chips = 11; // TODO: count automatically
        cs.player.r = 7; // TODO: find automatically
        cs.player.c = 7;
   } else if (n == 2) {
        cs.map = [
            ['     ', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', ],
            ['     ', '     ', 'WALL_', '     ', '     ', 'CHIP_', '     ', '     ', 'WALL_', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', ],
            ['     ', '     ', 'WALL_', '     ', '     ', '     ', '     ', '     ', 'WALL_', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', ],
            ['     ', '     ', 'WALL_', '     ', '     ', 'WALL_', '     ', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', '     ', ],
            ['WALL_', 'WALL_', 'WALL_', '     ', '     ', 'WALL_', '     ', '     ', '     ', 'WATER', 'WATER', '     ', '     ', '     ', '     ', '     ', 'CHIP_', 'WALL_', '     ', ],
            ['WALL_', 'END__', 'SOCK_', '     ', '     ', 'WALL_', 'WALL_', '     ', '     ', 'WATER', 'WATER', '     ', 'BLOCK', 'BLOCK', '     ', 'HELP_', '     ', 'WALL_', '     ', ],
            ['WALL_', 'WALL_', 'WALL_', '     ', '     ', 'WALL_', '     ', '     ', '     ', 'WATER', 'WATER', '     ', '     ', '     ', '     ', '     ', 'CHIP_', 'WALL_', '     ', ],
            ['     ', '     ', 'WALL_', '     ', '     ', 'WALL_', '     ', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', '     ', ],
            ['     ', '     ', 'WALL_', '     ', '     ', '     ', '     ', '     ', 'WALL_', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', ],
            ['     ', '     ', 'WALL_', '     ', '     ', 'CHIP_', '     ', '     ', 'WALL_', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', ],
            ['     ', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', ],
        ];
        cs.chips = 4;
        cs.player.r = 5;
        cs.player.c = 14;
        cs.wasps.push({r: 4, c: 6, dir: 'L', pi: 0, path: ['U', 'U', 'L', 'L', 'D', 'D', 'D', 'D', 'D', 'D', 'R', 'R', 'U', 'U', 'R', 'U', 'U', 'L']});
        cs.wasps.push({r: 5, c: 7, dir: 'U', pi: 0, path: ['U', 'L', 'U', 'U', 'L', 'L', 'D', 'D', 'D', 'D', 'D', 'D', 'R', 'R', 'U', 'U', 'R', 'U']});
        cs.wasps.push({r: 6, c: 6, dir: 'U', pi: 0, path: ['R', 'U', 'U', 'L', 'U', 'U', 'L', 'L', 'D', 'D', 'D', 'D', 'D', 'D', 'R', 'R', 'U', 'U']});
   } else if (n == 3) {
        cs.map = [
            ['     ', '     ', '     ', '     ', '     ', '     ', '     ', 'WALL_', 'WALL_', 'WALL_', '     ', '     ', '     ', '     ', '     ', '     ', ],
            ['     ', '     ', '     ', '     ', '     ', '     ', '     ', 'WALL_', 'END__', 'WALL_', '     ', '     ', '     ', '     ', '     ', '     ', ],
            ['     ', '     ', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'SOCK_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', '     ', '     ', '     ', ],
            ['     ', '     ', '     ', 'WALL_', 'PUSHD', 'PUSHL', 'PUSHL', 'PUSHL', 'PUSHL', 'PUSHL', 'PUSHL', 'PUSHL', 'WALL_', '     ', '     ', '     ', ],
            ['     ', '     ', '     ', 'WALL_', 'PUSHD', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'PUSHU', 'WALL_', '     ', '     ', '     ', ],
            ['WALL_', 'WALL_', 'WALL_', 'WALL_', 'PUSHD', 'WALL_', 'WATER', 'WATER', 'WATER', 'WATER', 'WALL_', 'PUSHU', 'WALL_', 'WALL_', 'WALL_', 'WALL_', ],
            ['WALL_', 'PUSHD', 'PUSHL', 'PUSHL', 'PUSHL', 'WALL_', 'WATER', 'SKATE', 'CHIP_', 'WATER', 'WALL_', 'PUSHU', 'PUSHL', 'PUSHL', 'PUSHL', 'WALL_', ],
            ['WALL_', 'PUSHD', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WATER', 'WATER', 'WATER', 'WATER', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'PUSHU', 'WALL_', ],
            ['WALL_', 'PUSHD', 'WALL_', 'ICE__', 'ICE__', 'ICE__', '     ', '     ', '     ', '     ', 'FIRE_', 'FIRE_', 'FIRE_', 'WALL_', 'PUSHU', 'WALL_', ],
            ['WALL_', 'PUSHD', 'WALL_', 'ICE__', 'BOOTR', 'WALL_', '     ', '     ', '     ', '     ', 'FIRE_', 'BOOTG', 'FIRE_', 'WALL_', 'PUSHU', 'WALL_', ],
            ['WALL_', 'PUSHD', 'WALL_', 'ICE__', 'CHIP_', 'WALL_', '     ', '     ', 'HELP_', '     ', 'FIRE_', 'CHIP_', 'FIRE_', 'WALL_', 'PUSHU', 'WALL_', ],
            ['WALL_', 'PUSHD', 'WALL_', 'ICE__', 'ICE__', 'ICE__', '     ', '     ', 'FLIP_', '     ', 'FIRE_', 'FIRE_', 'FIRE_', 'WALL_', 'PUSHU', 'WALL_', ],
            ['WALL_', 'PUSHD', 'WALL_', 'WALL_', 'WALL_', 'WALL_', '     ', '     ', '     ', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'PUSHU', 'WALL_', ],
            ['WALL_', 'PUSHR', 'PUSHR', 'PUSHR', 'PUSHR', 'PUSHR', 'PUSHU', 'PUSHU', 'PUSHU', 'PUSHR', 'PUSHR', 'PUSHR', 'PUSHR', 'PUSHR', 'PUSHU', 'WALL_', ],
            ['WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'PUSHU', 'CHIP_', 'PUSHU', 'PUSHU', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', ],
            ['     ', '     ', '     ', '     ', '     ', 'WALL_', 'PUSHU', 'PUSHU', 'PUSHU', 'PUSHU', 'WALL_', '     ', '     ', '     ', '     ', '     ', ],
            ['     ', '     ', '     ', '     ', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', '     ', '     ', '     ', '     ', '     ', ],
        ];
        cs.chips = 4;
        cs.player.r = 10;
        cs.player.c = 7;
   } else if (n == 4) {
        cs.map = [
            ['WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', ],
            ['WALL_', 'WALL_', '     ', '     ', '     ', '     ', '     ', 'CHIP_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', ],
            ['WALL_', '     ', '     ', 'WALL_', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', '     ', '     ', '     ', '     ', '     ', 'WALL_', '     ', '     ', '     ', '     ', '     ', 'WALL_', ],
            ['WALL_', 'WALL_', '     ', '     ', '     ', '     ', '     ', 'WALL_', 'WALL_', 'WALL_', 'SOCK_', 'WALL_', 'WALL_', 'END__', '     ', 'WALL_', '     ', '     ', 'WALL_', '     ', 'CHIP_', 'WALL_', ],
            ['WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', '     ', '     ', 'WALL_', '     ', '     ', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', '     ', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', ],
            ['WALL_', 'WALL_', '     ', '     ', '     ', '     ', '     ', 'WALL_', 'WALL_', '     ', '     ', '     ', 'WALL_', '     ', '     ', '     ', '     ', '     ', 'WALL_', '     ', '     ', 'WALL_', ],
            ['WALL_', '     ', '     ', 'WALL_', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', '     ', 'HELP_', '     ', 'WALL_', '     ', '     ', 'WALL_', '     ', '     ', '     ', '     ', 'CHIP_', 'WALL_', ],
            ['WALL_', 'WALL_', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', ],
            ['WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', '     ', 'WALL_', '     ', '     ', 'WALL_', '     ', '     ', '     ', '     ', 'CHIP_', 'WALL_', ],
            ['     ', '     ', '     ', '     ', 'WALL_', '     ', '     ', '     ', '     ', '     ', '     ', '     ', 'WALL_', '     ', '     ', '     ', '     ', '     ', 'WALL_', '     ', '     ', 'WALL_', ],
            ['     ', '     ', '     ', '     ', 'WALL_', '     ', 'BLOCK', '     ', 'BLOCK', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', '     ', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', ],
            ['     ', '     ', '     ', '     ', 'WALL_', '     ', '     ', 'BLOCK', '     ', '     ', 'WALL_', '     ', '     ', '     ', '     ', 'WALL_', '     ', '     ', 'WALL_', '     ', 'CHIP_', 'WALL_', ],
            ['     ', '     ', '     ', '     ', 'WALL_', '     ', 'BLOCK', '     ', 'BLOCK', '     ', 'WALL_', '     ', '     ', '     ', '     ', 'WALL_', '     ', '     ', '     ', '     ', '     ', 'WALL_', ],
            ['     ', '     ', '     ', '     ', 'WALL_', '     ', '     ', '     ', '     ', '     ', 'WALL_', '     ', '     ', '     ', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', ],
            ['     ', '     ', '     ', '     ', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', 'WALL_', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', '     ', ],
        ];
        cs.chips = 9;
        cs.player.r = 5;
        cs.player.c = 10;
    } else {
        // END GAME?
        level(1);
    }
}

function restartLevel()
{
    level(cs.level);
}

function nextLevel()
{
    level(cs.level+1);
}

function prevLevel()
{
    level(cs.level-1);
}

function reset() {
    resize();
    pressed = {};
    paused = false;
    advanceFrame = false;
    simulateInputs = false;
    accumulator = 0;
    frameCount = 0;
    simRate = 1.0;
    prevTime = 0;

    cs =  {
        level: 0,
        timer: TIMER_INTERVAL_MS,
    };

    nextLevel();

    saveState();
}

reset();

function px(x, f=0.0) { return Math.round(x) + f; }

function worldToScreen(coord) {
    return {
        x: width/2 + coord.x*sq - nc*sq/2,
        y: height/2 + coord.y*sq - nr*sq/2,
        w: coord.w * sq,
        h: coord.h * sq,
    };
}

function drawTexture(tex, rect) {
    const sr = worldToScreen(rect);
    ctx.drawImage(tex, px(sr.x), px(sr.y), sr.w, sr.h);
}

function draw() {
    ctx.clearRect(0, 0, width, height);

    // render objects here
    for (let r = 0; r < nr; r++) {
        for (let c = 0; c < nc; c++) {
            const rm = cs.player.r - Math.floor(nr/2) + r;
            const cm = cs.player.c - Math.floor(nc/2) + c;
            let m;
            if (rm < 0 || cm < 0 || rm >= cs.map.length || cm >= cs.map[0].length) m = null;
            else m = cs.map[rm][cm];
            let tex = null;
            if      (m == 'BALL')   tex = ball_tex;
            else if (m == 'BLOCK')  tex = block_tex;
            else if (m == 'X')      tex = blue_creature_tex;
            else if (m == 'X')      tex = blue_creature_down_tex;
            else if (m == 'X')      tex = blue_creature_left_tex;
            else if (m == 'X')      tex = blue_creature_right_tex;
            else if (m == 'X')      tex = bomb_tex;
            else if (m == 'FLIP_')  tex = boot_flipper_tex;
            else if (m == 'BOOTG')  tex = boot_green_tex;
            else if (m == 'BOOTR')  tex = boot_red_tex;
            else if (m == 'SKATE')  tex = boot_skate_tex;
            else if (m == 'X')      tex = border_empty_tex;
            else if (m == 'X')      tex = border_full_tex;
            else if (m == 'X')      tex = button_big_brown_tex;
            else if (m == 'X')      tex = button_big_cyan_tex;
            else if (m == 'X')      tex = button_big_gray_tex;
            else if (m == 'X')      tex = button_blue_tex;
            else if (m == 'X')      tex = button_brown_tex;
            else if (m == 'X')      tex = button_green_tex;
            else if (m == 'CHIP_')  tex = chip_tex;
            else if (m == 'END__')  tex = end_tex;
            else if (m == 'FIRE_')  tex = fire_tex;
            else if (m == '     ')  tex = floor_tex;
            else if (m == 'X')      tex = floor_edge_tex;
            else if (m == 'X')      tex = gravel_tex;
            else if (m == 'HELP_')  tex = help_tex;
            else if (m == 'ICE__')  tex = ice_tex;
            else if (m == 'KEYC_')  tex = key_cyan_tex;
            else if (m == 'KEYG_')  tex = key_green_tex;
            else if (m == 'KEYR_')  tex = key_red_tex;
            else if (m == 'KEYY_')  tex = key_yellow_tex;
            else if (m == 'LOCKC')  tex = lock_cyan_tex;
            else if (m == 'LOCKG')  tex = lock_green_tex;
            else if (m == 'LOCKR')  tex = lock_red_tex;
            else if (m == 'LOCKY')  tex = lock_yellow_tex;
            else if (m == 'X')      tex = missile_tex;
            else if (m == 'X')      tex = missile_shooter_tex;
            else if (m == 'X')      tex = monster_back_tex;
            else if (m == 'X')      tex = monster_front_tex;
            else if (m == 'X')      tex = monster_left_tex;
            else if (m == 'X')      tex = monster_right_tex;
            else if (m == 'X')      tex = player_back_tex;
            else if (m == 'PLAY')   tex = player_front_tex;
            else if (m == 'X')      tex = player_left_tex;
            else if (m == 'X')      tex = player_right_tex;
            else if (m == 'PUSHR')  tex = push_right_tex;
            else if (m == 'PUSHL')  tex = push_left_tex;
            else if (m == 'PUSHU')  tex = push_up_tex;
            else if (m == 'PUSHD')  tex = push_down_tex;
            else if (m == 'RAFT_')  tex = raft_tex;
            else if (m == 'X')      tex = ray_tex;
            else if (m == 'SOCK_')  tex = socket_tex;
            else if (m == 'X')      tex = spy_tex;
            else if (m == 'X')      tex = swim_back_tex;
            else if (m == 'X')      tex = swim_front_tex;
            else if (m == 'X')      tex = swim_left_tex;
            else if (m == 'X')      tex = swim_right_tex;
            else if (m == 'WALL_')  tex = wall_tex;
            else if (m == 'X')      tex = wall_blue_tex;
            else if (m == 'WASP_')  tex = wasp_tex;
            else if (m == 'WATER')  tex = water_tex;
            else                    tex = help_tex;

            drawTexture(tex, {x: c, y: r, w: 1, h: 1});
        }
    }

    let player_tex = player_front_tex;
    if (cs.map[cs.player.r][cs.player.c] == 'WATER')
        player_tex = swim_back_tex;
    else if (cs.map[cs.player.r][cs.player.c] == 'ICE__')
        player_tex = player_ice_front_tex;

    drawTexture(player_tex, {x: Math.floor(nc/2), y: Math.floor(nr/2), w: 1, h: 1});

    for (const wasp of cs.wasps) {
        // TODO: clip
        const rw = Math.floor(nr/2) + wasp.r - cs.player.r;
        const cw = Math.floor(nc/2) + wasp.c - cs.player.c;
        if (rw < 0 || rw >= nr || cw < 0 || cw >= nc)
            continue;
        // TODO: choose wasp_tex based on wasp.dir
        drawTexture(wasp_tex, {x: cw, y: rw, w: 1, h: 1});
    }

    if (paused) {
        ctx.font = `60px Calibri`;
        ctx.lineWidth = 2;
        ctx.fillStyle = "white";
        ctx.strokeStyle = "black";
        ctx.fillText("PAUSED", width/2 - 80, height/2);
        ctx.strokeText("PAUSED", width/2 - 80, height/2);
    }
}

function canGo(dr, dc)
{
    const r = cs.player.r + dr;
    const c = cs.player.c + dc;
    const r2 = cs.player.r + 2*dr;
    const c2 = cs.player.c + 2*dc;

    if (cs.map[r][c] == 'BLOCK') {
        if (cs.map[r2][c2] == '     ')
            return true;
        else if (cs.map[r2][c2] == 'WATER')
            return true;
        else
            return false;
    }

    if (cs.map[r][c] == 'WALL_')
        return false;

    if (cs.map[r][c] == 'LOCKR' && cs.player.keyr == 0)
        return false;
    if (cs.map[r][c] == 'LOCKY' && cs.player.keyy == 0)
        return false;
    if (cs.map[r][c] == 'LOCKC' && cs.player.keyc == 0)
        return false;
    if (cs.map[r][c] == 'LOCKG' && cs.player.keyg == 0)
        return false;

    if (cs.map[r][c] == 'SOCK_' && cs.chips > 0)
        return false;

    return true;
}

function move(dr, dc)
{
    const r = cs.player.r + dr;
    const c = cs.player.c + dc;
    const r2 = cs.player.r + 2*dr;
    const c2 = cs.player.c + 2*dc;

    if (cs.map[r][c] == 'LOCKR') {
        cs.map[r][c] = '     ';
        cs.player.keyr--;
    }
    if (cs.map[r][c] == 'LOCKY') {
        cs.map[r][c] = '     ';
        cs.player.keyy--;
    }
    if (cs.map[r][c] == 'LOCKC') {
        cs.map[r][c] = '     ';
        cs.player.keyc--;
    }
    if (cs.map[r][c] == 'LOCKG') {
        cs.map[r][c] = '     ';
        cs.player.keyg--;
    }

    if (cs.map[r][c] == 'BOOTR') {
        cs.map[r][c] = '     ';
        cs.player.boot_red = true;
    }
    if (cs.map[r][c] == 'BOOTG') {
        cs.map[r][c] = '     ';
        cs.player.boot_green = true;
    }
    if (cs.map[r][c] == 'FLIP_') {
        cs.map[r][c] = '     ';
        cs.player.boot_flipper = true;
    }
    if (cs.map[r][c] == 'SKATE') {
        cs.map[r][c] = '     ';
        cs.player.boot_skate = true;
    }

    if (cs.map[r][c] == 'KEYR_') {
        cs.map[r][c] = '     ';
        cs.player.keyr++;
    }
    if (cs.map[r][c] == 'KEYY_') {
        cs.map[r][c] = '     ';
        cs.player.keyy++;
    }
    if (cs.map[r][c] == 'KEYC_') {
        cs.map[r][c] = '     ';
        cs.player.keyc++;
    }
    if (cs.map[r][c] == 'KEYG_') {
        cs.map[r][c] = '     ';
        cs.player.keyg += 2; // TODO
    }

    if (cs.map[r][c] == 'RAFT_') {
        cs.map[r][c] = '     ';
    }

    if (cs.map[r][c] == 'BLOCK') {
        cs.map[r][c] = '     ';
        if (cs.map[r2][c2] == 'WATER')
            cs.map[r2][c2] = 'RAFT_';
        else
            cs.map[r2][c2] = 'BLOCK';
    }

    if (cs.map[r][c] == 'THIEF') {
        cs.player.keyr = 0;
        cs.player.keyg = 0;
        cs.player.keyy = 0;
        cs.player.keyc = 0;
        cs.boot_red = false;
        cs.boot_green = false;
        cs.boot_flipper = false;
        cs.boot_skate = false;
    }

    for (const wasp of cs.wasps) {
        if (wasp.r == r && wasp.c == c) {
            cs.player.r = r;
            cs.player.c = c;
            alert ("Look out for creatures!");
            restartLevel();
            return;
        }
    }

    if (cs.map[r][c] == 'FIRE_' && !cs.player.boot_red) {
        alert ("You died in a fire!");
        restartLevel();
        return;
    }

    if (cs.map[r][c] == 'WATER' && !cs.player.boot_flipper) {
        alert ("You drowned!");
        restartLevel();
        return;
    }

    if (cs.map[r][c] == 'CHIP_') {
        cs.map[r][c] = '     ';
        cs.chips--;
    }

    if (cs.map[r][c] == 'SOCK_') {
        cs.map[r][c] = '     ';
    }

    if (cs.map[r][c] == 'END__') {
        nextLevel();
        return;
    }

    cs.player.r = r;
    cs.player.c = c;
}

function handleInput(t, dt) {

    let dr = 0, dc = 0;
    if (pressed.ArrowLeft)  { dc = -1; }
    if (pressed.ArrowRight) { dc =  1; }
    if (pressed.ArrowUp)    { dr = -1; }
    if (pressed.ArrowDown)  { dr =  1; }

    const dstr = cs.player.r + dr;
    const dstc = cs.player.c + dc;

    if (canGo(dr, dc))
        move(dr, dc);

    pressed = {};
}

function update(t, dt) {
    // update game state here

    if (cs.timer > 0) {
        cs.timer -= dt;
        return;
    }
    cs.timer += TIMER_INTERVAL_MS;
    // TODO: wasps should only update ever other tick

    for (const wasp of cs.wasps) {
        const d = wasp.path[wasp.pi];
        if (d == 'U') {
            wasp.r--;
            wasp.dir = 'U';
        } else if (d == 'L') {
            wasp.c--;
            wasp.dir = 'L';
        } else if (d == 'R') {
            wasp.c++;
            wasp.dir = 'R';
        } else if (d == 'D') {
            wasp.r++;
            wasp.dir = 'D';
        }
        wasp.pi = (wasp.pi + 1) % wasp.path.length;
    }

    if (cs.map[cs.player.r][cs.player.c].substr(0,3) == 'ICE' && !cs.player.boot_skate) {
        // TODO: move player in direction they were going, redirect at corners
        if (cs.map[cs.player.r][cs.player.c] == 'ICE__')
            cs.player.c--;
        else if (cs.map[cs.player.r][cs.player.c] == 'ICE__')
            cs.player.c++;
        else if (cs.map[cs.player.r][cs.player.c] == 'ICE__')
            cs.player.r--;
        else if (cs.map[cs.player.r][cs.player.c] == 'ICE__')
            cs.player.r++;
    }

    if (cs.map[cs.player.r][cs.player.c].substr(0,4) == 'PUSH' && !cs.player.boot_green) {
        if (cs.map[cs.player.r][cs.player.c] == 'PUSHL')
            cs.player.c--;
        else if (cs.map[cs.player.r][cs.player.c] == 'PUSHR')
            cs.player.c++;
        else if (cs.map[cs.player.r][cs.player.c] == 'PUSHU')
            cs.player.r--;
        else if (cs.map[cs.player.r][cs.player.c] == 'PUSHD')
            cs.player.r++;
    }
}

function simulateInputOnFrame(n, verbose=true) {
    if (n in inputsToSim) {
        for (let input of inputsToSim[n]) {
            if (verbose) { console.log(`input '${input.key}' ${input.mode} on frame ${n}`); }
            let e = {key: input.key};
            if (input.mode == 'down')   { keydown(e); }
            else                        { keyup(e); }
        }
    }
}

function loop(t) {
    let frameTime = t - prevTime;
    prevTime = t;

    if (!paused || advanceFrame) {
        frameCount++;

        if (frameTime > MAX_FRAMETIME) {
            console.log(`frameTime > MAX_FRAMETIME : ${frameTime}`);
            frameTime = MAX_FRAMETIME;
        }

        accumulator += frameTime * simRate;

        while (accumulator >= fixed_dt) {
            if (simulateInputs)
                simulateInputOnFrame(frameCount);
            handleInput(t, fixed_dt);
            update(t, fixed_dt);
            accumulator -= fixed_dt;
        }
        advanceFrame = false;
    }
    draw();
    window.requestAnimationFrame(loop);
}

loop(0);

function blur(e) {
    paused = true;
}

function focus(e) {
}

function resize(e) {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
    const sqh = Math.round(height/(nr+1));
    const sqw = Math.round(width/(nc+1));
    //sq = Math.min(sqh, sqw);
    sq = 32;
}

function keydown(e) {
    if (e.key === 'Escape') {
        paused = !paused;
    } else if (e.key === 'n') {
        nextLevel();
    } else if (e.key === 'p') {
        prevLevel();
    } else if (e.key === 's') {
        saveState();
    } else if (e.key === 'd') {
        restoreState();
    } else if (e.key === ',' || e.key === '.') {
        if (e.key === ',')
            simRate /= 2;
        else if (e.key === '.')
            simRate *= 2;
        console.log(`simRate: ${simRate}`);
    } else if (e.key === '`') {
        advanceFrame = true;
    } else if (e.key === 'u') {
        // TODO: undo!
    } else if (e.key === 'U') {
        // TODO: redo!
    } else if (e.key === 'r') {
        //reset();
        restartLevel();
    } else {
        pressed[e.key] = true;
    }
}

function keyup(e) {
    if (e.key === 'Escape') {
    } else if (e.key === 'r') {
    } else {
        pressed[e.key] = false;
    }
}

window.addEventListener('blur', blur);
window.addEventListener('focus', focus);
window.addEventListener('keydown', keydown);
window.addEventListener('keyup', keyup);
window.addEventListener('resize', resize);



        </script>
    </body>

</html>
